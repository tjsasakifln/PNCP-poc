{
  "components": {
    "schemas": {
      "AdminAssignPlanResponse": {
        "description": "Response for POST /admin/users/{user_id}/assign-plan.",
        "properties": {
          "assigned": {
            "title": "Assigned",
            "type": "boolean"
          },
          "plan_id": {
            "title": "Plan Id",
            "type": "string"
          },
          "user_id": {
            "title": "User Id",
            "type": "string"
          }
        },
        "required": [
          "assigned",
          "user_id",
          "plan_id"
        ],
        "title": "AdminAssignPlanResponse",
        "type": "object"
      },
      "AdminCreateUserResponse": {
        "description": "Response for POST /admin/users.",
        "properties": {
          "email": {
            "title": "Email",
            "type": "string"
          },
          "plan_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Plan Id"
          },
          "user_id": {
            "title": "User Id",
            "type": "string"
          }
        },
        "required": [
          "user_id",
          "email"
        ],
        "title": "AdminCreateUserResponse",
        "type": "object"
      },
      "AdminDeleteUserResponse": {
        "description": "Response for DELETE /admin/users/{user_id}.",
        "properties": {
          "deleted": {
            "title": "Deleted",
            "type": "boolean"
          },
          "user_id": {
            "title": "User Id",
            "type": "string"
          }
        },
        "required": [
          "deleted",
          "user_id"
        ],
        "title": "AdminDeleteUserResponse",
        "type": "object"
      },
      "AdminResetPasswordResponse": {
        "description": "Response for POST /admin/users/{user_id}/reset-password.",
        "properties": {
          "success": {
            "title": "Success",
            "type": "boolean"
          },
          "user_id": {
            "title": "User Id",
            "type": "string"
          }
        },
        "required": [
          "success",
          "user_id"
        ],
        "title": "AdminResetPasswordResponse",
        "type": "object"
      },
      "AdminUpdateCreditsResponse": {
        "description": "Response for PUT /admin/users/{user_id}/credits.",
        "properties": {
          "credits": {
            "title": "Credits",
            "type": "integer"
          },
          "previous_credits": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Previous Credits"
          },
          "subscription_created": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Subscription Created"
          },
          "success": {
            "title": "Success",
            "type": "boolean"
          },
          "user_id": {
            "title": "User Id",
            "type": "string"
          }
        },
        "required": [
          "success",
          "user_id",
          "credits"
        ],
        "title": "AdminUpdateCreditsResponse",
        "type": "object"
      },
      "AdminUpdateUserResponse": {
        "description": "Response for PUT /admin/users/{user_id}.",
        "properties": {
          "updated": {
            "title": "Updated",
            "type": "boolean"
          },
          "user_id": {
            "title": "User Id",
            "type": "string"
          }
        },
        "required": [
          "updated",
          "user_id"
        ],
        "title": "AdminUpdateUserResponse",
        "type": "object"
      },
      "AdminUsersListResponse": {
        "description": "Response for GET /admin/users.",
        "properties": {
          "limit": {
            "title": "Limit",
            "type": "integer"
          },
          "offset": {
            "title": "Offset",
            "type": "integer"
          },
          "total": {
            "title": "Total",
            "type": "integer"
          },
          "users": {
            "items": {
              "additionalProperties": true,
              "type": "object"
            },
            "title": "Users",
            "type": "array"
          }
        },
        "required": [
          "users",
          "total",
          "limit",
          "offset"
        ],
        "title": "AdminUsersListResponse",
        "type": "object"
      },
      "AuthStatusResponse": {
        "properties": {
          "confirmed": {
            "title": "Confirmed",
            "type": "boolean"
          },
          "user_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "User Id"
          }
        },
        "required": [
          "confirmed"
        ],
        "title": "AuthStatusResponse",
        "type": "object"
      },
      "BillingPlansResponse": {
        "description": "Response for GET /plans (billing.py).",
        "properties": {
          "plans": {
            "items": {
              "additionalProperties": true,
              "type": "object"
            },
            "title": "Plans",
            "type": "array"
          }
        },
        "required": [
          "plans"
        ],
        "title": "BillingPlansResponse",
        "type": "object"
      },
      "BuscaRequest": {
        "description": "Request schema for /buscar endpoint.\n\nValidates user input for procurement search:\n- At least 1 Brazilian state (UF) must be selected\n- Dates must be in YYYY-MM-DD format\n- data_inicial must be <= data_final\n- Date range cannot exceed 30 days\n- data_final cannot be in the future\n- valor_maximo must be >= valor_minimo (if both provided)\n\nExamples:\n    >>> request = BuscaRequest(\n    ...     ufs=[\"SP\", \"RJ\"],\n    ...     data_inicial=\"2025-01-01\",\n    ...     data_final=\"2025-01-31\"\n    ... )\n    >>> request.ufs\n    ['SP', 'RJ']\n\n    >>> # With new P0/P1 filters\n    >>> request = BuscaRequest(\n    ...     ufs=[\"SP\"],\n    ...     data_inicial=\"2025-01-01\",\n    ...     data_final=\"2025-01-31\",\n    ...     status=StatusLicitacao.RECEBENDO_PROPOSTA,\n    ...     modalidades=[1, 2, 6],\n    ...     valor_minimo=50000,\n    ...     valor_maximo=500000,\n    ...     esferas=[EsferaGovernamental.MUNICIPAL]\n    ... )",
        "example": {
          "data_final": "2025-01-31",
          "data_inicial": "2025-01-01",
          "esferas": [
            "M"
          ],
          "modalidades": [
            4,
            5,
            6,
            7
          ],
          "ordenacao": "data_desc",
          "status": "recebendo_proposta",
          "ufs": [
            "SP",
            "RJ"
          ],
          "valor_maximo": 500000,
          "valor_minimo": 50000
        },
        "properties": {
          "check_sanctions": {
            "default": false,
            "description": "When true, verify supplier CNPJs against CEIS/CNEP sanctions databases. Adds supplier_sanctions field to each result. Performance impact: ~1s per unique CNPJ.",
            "title": "Check Sanctions",
            "type": "boolean"
          },
          "data_final": {
            "description": "End date in YYYY-MM-DD format",
            "examples": [
              "2025-01-31"
            ],
            "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
            "title": "Data Final",
            "type": "string"
          },
          "data_inicial": {
            "description": "Start date in YYYY-MM-DD format",
            "examples": [
              "2025-01-01"
            ],
            "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
            "title": "Data Inicial",
            "type": "string"
          },
          "esferas": {
            "anyOf": [
              {
                "items": {
                  "$ref": "#/components/schemas/EsferaGovernamental"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "description": "Lista de esferas governamentais ('F'=Federal, 'E'=Estadual, 'M'=Municipal). None = todas as esferas.",
            "examples": [
              [
                "M",
                "E"
              ]
            ],
            "title": "Esferas"
          },
          "exclusion_terms": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "description": "Custom exclusion terms. Overrides sector exclusions when provided.",
            "title": "Exclusion Terms"
          },
          "force_fresh": {
            "default": false,
            "description": "When true, bypass result cache and always query primary sources. Cache write-through still happens on successful results.",
            "title": "Force Fresh",
            "type": "boolean"
          },
          "itens_por_pagina": {
            "default": 20,
            "description": "Quantidade de itens por p\u00e1gina. Valores permitidos: 10, 20, 50, 100. Padr\u00e3o: 20.",
            "examples": [
              10,
              20,
              50,
              100
            ],
            "maximum": 100.0,
            "minimum": 10.0,
            "title": "Itens Por Pagina",
            "type": "integer"
          },
          "modalidades": {
            "anyOf": [
              {
                "items": {
                  "type": "integer"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "description": "Lista de c\u00f3digos de modalidade conforme API PNCP. C\u00f3digos v\u00e1lidos: 1 (Leil\u00e3o Eletr\u00f4nico), 2 (Di\u00e1logo Competitivo), 3 (Concurso), 4 (Concorr\u00eancia Eletr\u00f4nica), 5 (Concorr\u00eancia Presencial), 6 (Preg\u00e3o Eletr\u00f4nico), 7 (Preg\u00e3o Presencial), 8 (Dispensa), 10 (Manifesta\u00e7\u00e3o de Interesse), 11 (Pr\u00e9-qualifica\u00e7\u00e3o), 12 (Credenciamento), 13 (Leil\u00e3o Presencial), 15 (Chamada P\u00fablica). None = modalidades padr\u00e3o [4, 5, 6, 7]. EXCLU\u00cdDOS: 9 (Inexigibilidade) e 14 (Inaplicabilidade) \u2014 vencedor pr\u00e9-definido.",
            "examples": [
              [
                4,
                5,
                6,
                7
              ]
            ],
            "title": "Modalidades"
          },
          "modo_busca": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": "abertas",
            "description": "Modo de busca: 'abertas' (padr\u00e3o) busca licita\u00e7\u00f5es com prazo aberto nos \u00faltimos 180 dias; 'publicacao' usa datas enviadas pelo frontend.",
            "examples": [
              "abertas",
              "publicacao"
            ],
            "title": "Modo Busca"
          },
          "municipios": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "description": "Lista de c\u00f3digos IBGE de munic\u00edpios para filtrar. None = todos os munic\u00edpios das UFs selecionadas.",
            "examples": [
              [
                "3550308",
                "3304557"
              ]
            ],
            "title": "Municipios"
          },
          "ordenacao": {
            "default": "data_desc",
            "description": "Crit\u00e9rio de ordena\u00e7\u00e3o dos resultados: 'data_desc' (mais recente), 'data_asc' (mais antigo), 'valor_desc' (maior valor), 'valor_asc' (menor valor), 'prazo_asc' (prazo mais pr\u00f3ximo), 'relevancia' (score de matching).",
            "examples": [
              "data_desc",
              "valor_desc",
              "prazo_asc"
            ],
            "title": "Ordenacao",
            "type": "string"
          },
          "orgaos": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "description": "Lista de nomes de \u00f3rg\u00e3os/entidades para filtrar (busca parcial). None = todos os \u00f3rg\u00e3os.",
            "examples": [
              [
                "Prefeitura de S\u00e3o Paulo",
                "Minist\u00e9rio da Sa\u00fade"
              ]
            ],
            "title": "Orgaos"
          },
          "pagina": {
            "default": 1,
            "description": "N\u00famero da p\u00e1gina de resultados (1-indexed). Padr\u00e3o: 1.",
            "examples": [
              1,
              2,
              3
            ],
            "minimum": 1.0,
            "title": "Pagina",
            "type": "integer"
          },
          "search_id": {
            "anyOf": [
              {
                "maxLength": 36,
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "Client-generated UUID for SSE progress tracking via /buscar-progress/{search_id}.",
            "title": "Search Id"
          },
          "setor_id": {
            "default": "vestuario",
            "description": "Sector ID for keyword filtering (e.g., 'vestuario', 'alimentos', 'informatica')",
            "examples": [
              "vestuario"
            ],
            "title": "Setor Id",
            "type": "string"
          },
          "show_all_matches": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "default": false,
            "description": "When True, bypasses minimum match floor and returns all results with at least 1 keyword match (for 'show hidden results' feature).",
            "title": "Show All Matches"
          },
          "status": {
            "$ref": "#/components/schemas/StatusLicitacao",
            "default": "todos",
            "description": "Status da licita\u00e7\u00e3o para filtrar. Padr\u00e3o: 'todos' (sem filtro de status). IMPORTANTE: Filtro de status desabilitado por padr\u00e3o devido a valores inconsistentes na API PNCP. Use 'todos' para m\u00e1xima cobertura de resultados.",
            "examples": [
              "todos",
              "recebendo_proposta",
              "em_julgamento",
              "encerrada"
            ]
          },
          "termos_busca": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "Custom search terms. Use commas to separate multi-word phrases (e.g., 'levantamento topogr\u00e1fico, terraplenagem, drenagem'). Without commas, spaces separate individual keywords (legacy mode).",
            "examples": [
              "jaleco avental",
              "levantamento topogr\u00e1fico, terraplenagem, drenagem"
            ],
            "title": "Termos Busca"
          },
          "ufs": {
            "description": "List of Brazilian state codes (e.g., ['SP', 'RJ', 'MG'])",
            "examples": [
              [
                "SP",
                "RJ"
              ]
            ],
            "items": {
              "type": "string"
            },
            "minItems": 1,
            "title": "Ufs",
            "type": "array"
          },
          "valor_maximo": {
            "anyOf": [
              {
                "minimum": 0.0,
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "description": "Valor m\u00e1ximo estimado da licita\u00e7\u00e3o em BRL. None = sem limite superior.",
            "examples": [
              5000000.0
            ],
            "title": "Valor Maximo"
          },
          "valor_minimo": {
            "anyOf": [
              {
                "minimum": 0.0,
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "description": "Valor m\u00ednimo estimado da licita\u00e7\u00e3o em BRL. None = sem limite inferior.",
            "examples": [
              50000.0
            ],
            "title": "Valor Minimo"
          }
        },
        "required": [
          "ufs",
          "data_inicial",
          "data_final"
        ],
        "title": "BuscaRequest",
        "type": "object"
      },
      "BuscaResponse": {
        "description": "Response schema for /buscar endpoint.\n\nReturns the complete search results including:\n- AI-generated executive summary\n- Excel file as base64-encoded string (optional, based on plan)\n- Statistics about raw vs filtered results\n- Quota information for user awareness\n\nThe Excel file can be decoded and downloaded by the frontend.",
        "example": {
          "excel_available": true,
          "excel_base64": "UEsDBBQABg...",
          "quota_remaining": 26,
          "quota_used": 24,
          "resumo": {
            "destaques": [
              "3 urgentes"
            ],
            "resumo_executivo": "Encontradas 15 licita\u00e7\u00f5es.",
            "total_oportunidades": 15,
            "valor_total": 2300000.0
          },
          "total_filtrado": 15,
          "total_raw": 523,
          "ultima_atualizacao": "2026-02-10T14:30:00Z"
        },
        "properties": {
          "cached": {
            "default": false,
            "description": "True when results are served from cache (STORY-257A AC9)",
            "title": "Cached",
            "type": "boolean"
          },
          "cached_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "ISO timestamp of when cached results were generated",
            "title": "Cached At"
          },
          "cached_sources": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "description": "GTM-FIX-010 AC5r: Source codes that contributed to cached data (e.g. ['PNCP','PORTAL_COMPRAS'])",
            "title": "Cached Sources"
          },
          "data_sources": {
            "anyOf": [
              {
                "items": {
                  "$ref": "#/components/schemas/DataSourceStatus"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "description": "Detailed status breakdown of each data source (None for backward compatibility)",
            "title": "Data Sources"
          },
          "degradation_reason": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "Human-readable explanation of partial results (e.g., 'PNCP indispon\u00edvel, resultados de fontes alternativas')",
            "title": "Degradation Reason"
          },
          "download_url": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "Signed URL for direct Excel download (60min TTL, preferred over base64)",
            "title": "Download Url"
          },
          "excel_available": {
            "description": "Whether Excel export is available for user's plan",
            "title": "Excel Available",
            "type": "boolean"
          },
          "excel_base64": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "Excel file encoded as base64 string (None if plan doesn't allow or storage used)",
            "title": "Excel Base64"
          },
          "failed_ufs": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "description": "List of UF codes that failed during fetch (timeout or error)",
            "title": "Failed Ufs"
          },
          "filter_relaxed": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "description": "True if the minimum match filter was relaxed from strict to 1 due to zero results",
            "title": "Filter Relaxed"
          },
          "filter_stats": {
            "anyOf": [
              {
                "$ref": "#/components/schemas/FilterStats"
              },
              {
                "type": "null"
              }
            ],
            "description": "Breakdown of filter rejection reasons"
          },
          "hidden_by_min_match": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "description": "Number of bids that matched at least 1 term but were below the minimum match floor",
            "title": "Hidden By Min Match"
          },
          "is_partial": {
            "default": false,
            "description": "True when not all configured data sources responded successfully (some timed out/failed)",
            "title": "Is Partial",
            "type": "boolean"
          },
          "is_truncated": {
            "default": false,
            "description": "True when at least one UF hit the max_pages limit (data may be incomplete)",
            "title": "Is Truncated",
            "type": "boolean"
          },
          "licitacoes": {
            "description": "List of individual bids for display. FREE tier shows 5-10 fully, rest blurred.",
            "items": {
              "$ref": "#/components/schemas/LicitacaoItem"
            },
            "title": "Licitacoes",
            "type": "array"
          },
          "quota_remaining": {
            "description": "Monthly searches remaining",
            "minimum": 0.0,
            "title": "Quota Remaining",
            "type": "integer"
          },
          "quota_used": {
            "description": "Monthly searches used after this request",
            "minimum": 0.0,
            "title": "Quota Used",
            "type": "integer"
          },
          "resumo": {
            "$ref": "#/components/schemas/ResumoEstrategico",
            "description": "Strategic executive summary with actionable recommendations (AI-generated or fallback)"
          },
          "source_stats": {
            "anyOf": [
              {
                "items": {
                  "additionalProperties": true,
                  "type": "object"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "description": "Per-source fetch metrics when multi-source is active",
            "title": "Source Stats"
          },
          "sources_used": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "description": "List of source codes that returned data (e.g., ['PNCP', 'PORTAL_COMPRAS'])",
            "title": "Sources Used"
          },
          "stopwords_removidas": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "description": "Stopwords stripped from user input (for transparency)",
            "title": "Stopwords Removidas"
          },
          "succeeded_ufs": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "description": "List of UF codes that returned data successfully",
            "title": "Succeeded Ufs"
          },
          "termos_utilizados": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "description": "Keywords effectively used for filtering (after stopword removal)",
            "title": "Termos Utilizados"
          },
          "total_filtrado": {
            "description": "Records after applying filters (UF, value, keywords, deadline)",
            "minimum": 0.0,
            "title": "Total Filtrado",
            "type": "integer"
          },
          "total_raw": {
            "description": "Total records fetched from PNCP API (before filtering)",
            "minimum": 0.0,
            "title": "Total Raw",
            "type": "integer"
          },
          "total_ufs_requested": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "description": "Total number of UFs in the original request",
            "title": "Total Ufs Requested"
          },
          "truncated_ufs": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "description": "UF codes where results were truncated due to max_pages limit",
            "title": "Truncated Ufs"
          },
          "truncation_details": {
            "anyOf": [
              {
                "additionalProperties": {
                  "type": "boolean"
                },
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "description": "Per-source truncation flags, e.g. {'pncp': true, 'portal_compras': false}. None when no truncation occurred (backward compatible).",
            "title": "Truncation Details"
          },
          "ultima_atualizacao": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "ISO timestamp of when search results were generated",
            "title": "Ultima Atualizacao"
          },
          "upgrade_message": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "Message shown when Excel is blocked, encouraging upgrade",
            "title": "Upgrade Message"
          }
        },
        "required": [
          "resumo",
          "excel_available",
          "quota_used",
          "quota_remaining",
          "total_raw",
          "total_filtrado"
        ],
        "title": "BuscaResponse",
        "type": "object"
      },
      "CancelSubscriptionResponse": {
        "description": "Response for subscription cancellation.",
        "properties": {
          "ends_at": {
            "title": "Ends At",
            "type": "string"
          },
          "message": {
            "title": "Message",
            "type": "string"
          },
          "success": {
            "title": "Success",
            "type": "boolean"
          }
        },
        "required": [
          "success",
          "ends_at",
          "message"
        ],
        "title": "CancelSubscriptionResponse",
        "type": "object"
      },
      "CheckoutResponse": {
        "description": "Response for POST /checkout.",
        "properties": {
          "checkout_url": {
            "title": "Checkout Url",
            "type": "string"
          }
        },
        "required": [
          "checkout_url"
        ],
        "title": "CheckoutResponse",
        "type": "object"
      },
      "ConversationCategory": {
        "description": "Category for support conversations.",
        "enum": [
          "suporte",
          "sugestao",
          "funcionalidade",
          "bug",
          "outro"
        ],
        "title": "ConversationCategory",
        "type": "string"
      },
      "ConversationDetail": {
        "description": "Full conversation with messages thread.",
        "properties": {
          "category": {
            "title": "Category",
            "type": "string"
          },
          "created_at": {
            "title": "Created At",
            "type": "string"
          },
          "id": {
            "title": "Id",
            "type": "string"
          },
          "last_message_at": {
            "title": "Last Message At",
            "type": "string"
          },
          "messages": {
            "default": [],
            "items": {
              "$ref": "#/components/schemas/MessageResponse"
            },
            "title": "Messages",
            "type": "array"
          },
          "status": {
            "title": "Status",
            "type": "string"
          },
          "subject": {
            "title": "Subject",
            "type": "string"
          },
          "user_email": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "User Email"
          },
          "user_id": {
            "title": "User Id",
            "type": "string"
          }
        },
        "required": [
          "id",
          "user_id",
          "subject",
          "category",
          "status",
          "last_message_at",
          "created_at"
        ],
        "title": "ConversationDetail",
        "type": "object"
      },
      "ConversationStatus": {
        "description": "Status of a support conversation.",
        "enum": [
          "aberto",
          "respondido",
          "resolvido"
        ],
        "title": "ConversationStatus",
        "type": "string"
      },
      "ConversationSummary": {
        "description": "Summary of a conversation for list views.",
        "properties": {
          "category": {
            "title": "Category",
            "type": "string"
          },
          "created_at": {
            "title": "Created At",
            "type": "string"
          },
          "id": {
            "title": "Id",
            "type": "string"
          },
          "last_message_at": {
            "title": "Last Message At",
            "type": "string"
          },
          "status": {
            "title": "Status",
            "type": "string"
          },
          "subject": {
            "title": "Subject",
            "type": "string"
          },
          "unread_count": {
            "default": 0,
            "title": "Unread Count",
            "type": "integer"
          },
          "user_email": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "User Email"
          },
          "user_id": {
            "title": "User Id",
            "type": "string"
          }
        },
        "required": [
          "id",
          "user_id",
          "subject",
          "category",
          "status",
          "last_message_at",
          "created_at"
        ],
        "title": "ConversationSummary",
        "type": "object"
      },
      "ConversationsListResponse": {
        "description": "Paginated list of conversations.",
        "properties": {
          "conversations": {
            "items": {
              "$ref": "#/components/schemas/ConversationSummary"
            },
            "title": "Conversations",
            "type": "array"
          },
          "total": {
            "title": "Total",
            "type": "integer"
          }
        },
        "required": [
          "conversations",
          "total"
        ],
        "title": "ConversationsListResponse",
        "type": "object"
      },
      "CreateConversationRequest": {
        "description": "Request to create a new conversation with first message.",
        "properties": {
          "body": {
            "maxLength": 5000,
            "minLength": 1,
            "title": "Body",
            "type": "string"
          },
          "category": {
            "$ref": "#/components/schemas/ConversationCategory"
          },
          "subject": {
            "maxLength": 200,
            "minLength": 1,
            "title": "Subject",
            "type": "string"
          }
        },
        "required": [
          "subject",
          "category",
          "body"
        ],
        "title": "CreateConversationRequest",
        "type": "object"
      },
      "CreateConversationResponse": {
        "description": "Response for POST /api/messages/conversations.",
        "properties": {
          "id": {
            "title": "Id",
            "type": "string"
          },
          "status": {
            "title": "Status",
            "type": "string"
          }
        },
        "required": [
          "id",
          "status"
        ],
        "title": "CreateConversationResponse",
        "type": "object"
      },
      "CreateUserRequest": {
        "properties": {
          "company": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Company"
          },
          "email": {
            "description": "User email",
            "title": "Email",
            "type": "string"
          },
          "full_name": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Full Name"
          },
          "password": {
            "description": "User password (min 8 chars, 1 uppercase, 1 digit)",
            "minLength": 8,
            "title": "Password",
            "type": "string"
          },
          "plan_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": "free_trial",
            "description": "Initial plan",
            "title": "Plan Id"
          }
        },
        "required": [
          "email",
          "password"
        ],
        "title": "CreateUserRequest",
        "type": "object"
      },
      "DataSourceStatus": {
        "description": "Status information for a single data source in multi-source fetching.\n\nUsed to provide transparency about which sources contributed to results\nand which failed/timed out during the search operation.",
        "properties": {
          "records": {
            "default": 0,
            "description": "Number of records successfully returned by this source",
            "minimum": 0.0,
            "title": "Records",
            "type": "integer"
          },
          "source": {
            "description": "Data source identifier (e.g., 'pncp', 'compras_gov', 'portal')",
            "title": "Source",
            "type": "string"
          },
          "status": {
            "description": "Source status: 'ok' (success), 'timeout' (timed out), 'error' (failed), 'skipped' (not attempted)",
            "title": "Status",
            "type": "string"
          }
        },
        "required": [
          "source",
          "status"
        ],
        "title": "DataSourceStatus",
        "type": "object"
      },
      "DebugPNCPResponse": {
        "description": "Response for GET /debug/pncp-test endpoint.",
        "properties": {
          "elapsed_ms": {
            "title": "Elapsed Ms",
            "type": "integer"
          },
          "error": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Error"
          },
          "error_type": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Error Type"
          },
          "items_returned": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Items Returned"
          },
          "success": {
            "title": "Success",
            "type": "boolean"
          },
          "total_registros": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Total Registros"
          }
        },
        "required": [
          "success",
          "elapsed_ms"
        ],
        "title": "DebugPNCPResponse",
        "type": "object"
      },
      "DeleteAccountResponse": {
        "description": "Response for DELETE /me.",
        "properties": {
          "message": {
            "title": "Message",
            "type": "string"
          },
          "success": {
            "title": "Success",
            "type": "boolean"
          }
        },
        "required": [
          "success",
          "message"
        ],
        "title": "DeleteAccountResponse",
        "type": "object"
      },
      "DimensionItem": {
        "properties": {
          "count": {
            "title": "Count",
            "type": "integer"
          },
          "name": {
            "title": "Name",
            "type": "string"
          },
          "value": {
            "title": "Value",
            "type": "number"
          }
        },
        "required": [
          "name",
          "count",
          "value"
        ],
        "title": "DimensionItem",
        "type": "object"
      },
      "EsferaGovernamental": {
        "description": "Esfera governamental para filtro de busca.\n\nDefine o n\u00edvel de governo do \u00f3rg\u00e3o contratante:\n- FEDERAL (F): Uni\u00e3o, minist\u00e9rios, autarquias federais\n- ESTADUAL (E): Estados, DF, secretarias estaduais\n- MUNICIPAL (M): Prefeituras, c\u00e2maras municipais",
        "enum": [
          "F",
          "E",
          "M"
        ],
        "title": "EsferaGovernamental",
        "type": "string"
      },
      "ExperienciaLicitacoes": {
        "description": "Procurement experience level.",
        "enum": [
          "PRIMEIRA_VEZ",
          "INICIANTE",
          "EXPERIENTE"
        ],
        "title": "ExperienciaLicitacoes",
        "type": "string"
      },
      "FeatureInfo": {
        "description": "Single feature flag information.",
        "properties": {
          "enabled": {
            "title": "Enabled",
            "type": "boolean"
          },
          "key": {
            "title": "Key",
            "type": "string"
          },
          "metadata": {
            "anyOf": [
              {
                "additionalProperties": true,
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Metadata"
          }
        },
        "required": [
          "key",
          "enabled"
        ],
        "title": "FeatureInfo",
        "type": "object"
      },
      "FilterStats": {
        "description": "Statistics about filter rejection reasons.",
        "properties": {
          "rejeitadas_keyword": {
            "default": 0,
            "description": "Rejected by keyword match (zero matches)",
            "title": "Rejeitadas Keyword",
            "type": "integer"
          },
          "rejeitadas_min_match": {
            "default": 0,
            "description": "Rejected by minimum match floor (had matches but below threshold)",
            "title": "Rejeitadas Min Match",
            "type": "integer"
          },
          "rejeitadas_outros": {
            "default": 0,
            "description": "Rejected by other reasons",
            "title": "Rejeitadas Outros",
            "type": "integer"
          },
          "rejeitadas_prazo": {
            "default": 0,
            "description": "Rejected by deadline",
            "title": "Rejeitadas Prazo",
            "type": "integer"
          },
          "rejeitadas_uf": {
            "default": 0,
            "description": "Rejected by UF filter",
            "title": "Rejeitadas Uf",
            "type": "integer"
          },
          "rejeitadas_valor": {
            "default": 0,
            "description": "Rejected by value range",
            "title": "Rejeitadas Valor",
            "type": "integer"
          }
        },
        "title": "FilterStats",
        "type": "object"
      },
      "FirstAnalysisRequest": {
        "description": "Request for automatic first analysis after onboarding (GTM-004 AC1).",
        "properties": {
          "cnae": {
            "description": "CNAE code or business segment text",
            "maxLength": 20,
            "title": "Cnae",
            "type": "string"
          },
          "faixa_valor_max": {
            "anyOf": [
              {
                "minimum": 0.0,
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "description": "Max contract value in BRL (not cents)",
            "title": "Faixa Valor Max"
          },
          "faixa_valor_min": {
            "anyOf": [
              {
                "minimum": 0.0,
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "description": "Min contract value in BRL (not cents)",
            "title": "Faixa Valor Min"
          },
          "objetivo_principal": {
            "default": "",
            "description": "User's primary objective",
            "maxLength": 200,
            "title": "Objetivo Principal",
            "type": "string"
          },
          "ufs": {
            "description": "States of operation",
            "items": {
              "type": "string"
            },
            "maxItems": 27,
            "minItems": 1,
            "title": "Ufs",
            "type": "array"
          }
        },
        "required": [
          "cnae",
          "ufs"
        ],
        "title": "FirstAnalysisRequest",
        "type": "object"
      },
      "FirstAnalysisResponse": {
        "description": "Response from first analysis endpoint (GTM-004 AC3).",
        "properties": {
          "message": {
            "default": "",
            "description": "User-facing status message",
            "title": "Message",
            "type": "string"
          },
          "search_id": {
            "description": "UUID for tracking search progress via SSE",
            "title": "Search Id",
            "type": "string"
          },
          "setor_id": {
            "default": "vestuario",
            "description": "Resolved sector ID from CNAE mapping",
            "title": "Setor Id",
            "type": "string"
          },
          "status": {
            "default": "in_progress",
            "description": "Search status",
            "title": "Status",
            "type": "string"
          }
        },
        "required": [
          "search_id"
        ],
        "title": "FirstAnalysisResponse",
        "type": "object"
      },
      "GoogleSheetsExportHistory": {
        "description": "Schema for individual export history entry.",
        "properties": {
          "created_at": {
            "description": "Creation timestamp (ISO 8601)",
            "title": "Created At",
            "type": "string"
          },
          "id": {
            "description": "Export record UUID",
            "title": "Id",
            "type": "string"
          },
          "last_updated_at": {
            "description": "Last update timestamp (ISO 8601)",
            "title": "Last Updated At",
            "type": "string"
          },
          "search_params": {
            "additionalProperties": true,
            "description": "Search parameters snapshot",
            "title": "Search Params",
            "type": "object"
          },
          "spreadsheet_id": {
            "description": "Google Sheets spreadsheet ID",
            "title": "Spreadsheet Id",
            "type": "string"
          },
          "spreadsheet_url": {
            "description": "Shareable URL",
            "title": "Spreadsheet Url",
            "type": "string"
          },
          "total_rows": {
            "description": "Number of rows exported",
            "title": "Total Rows",
            "type": "integer"
          }
        },
        "required": [
          "id",
          "spreadsheet_id",
          "spreadsheet_url",
          "search_params",
          "total_rows",
          "created_at",
          "last_updated_at"
        ],
        "title": "GoogleSheetsExportHistory",
        "type": "object"
      },
      "GoogleSheetsExportHistoryResponse": {
        "description": "Response schema for export history endpoint.",
        "properties": {
          "exports": {
            "description": "List of user's Google Sheets exports",
            "items": {
              "$ref": "#/components/schemas/GoogleSheetsExportHistory"
            },
            "title": "Exports",
            "type": "array"
          },
          "total": {
            "description": "Total number of exports in history",
            "minimum": 0.0,
            "title": "Total",
            "type": "integer"
          }
        },
        "required": [
          "exports",
          "total"
        ],
        "title": "GoogleSheetsExportHistoryResponse",
        "type": "object"
      },
      "GoogleSheetsExportRequest": {
        "description": "Request schema for Google Sheets export endpoint.\n\nSupports both \"create new spreadsheet\" and \"update existing\" modes.",
        "properties": {
          "licitacoes": {
            "description": "List of procurement contracts to export",
            "items": {
              "additionalProperties": true,
              "type": "object"
            },
            "maxItems": 10000,
            "minItems": 1,
            "title": "Licitacoes",
            "type": "array"
          },
          "mode": {
            "default": "create",
            "description": "'create' for new spreadsheet, 'update' for existing",
            "pattern": "^(create|update)$",
            "title": "Mode",
            "type": "string"
          },
          "spreadsheet_id": {
            "anyOf": [
              {
                "pattern": "^[a-zA-Z0-9_-]{44}$",
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "Google Sheets spreadsheet ID (required for mode='update')",
            "title": "Spreadsheet Id"
          },
          "title": {
            "description": "Spreadsheet title",
            "maxLength": 100,
            "minLength": 1,
            "title": "Title",
            "type": "string"
          }
        },
        "required": [
          "licitacoes",
          "title"
        ],
        "title": "GoogleSheetsExportRequest",
        "type": "object"
      },
      "GoogleSheetsExportResponse": {
        "description": "Response schema for successful Google Sheets export.",
        "properties": {
          "spreadsheet_id": {
            "description": "Google Sheets spreadsheet ID",
            "title": "Spreadsheet Id",
            "type": "string"
          },
          "spreadsheet_url": {
            "description": "Full shareable URL to the spreadsheet",
            "title": "Spreadsheet Url",
            "type": "string"
          },
          "success": {
            "default": true,
            "description": "Export success indicator",
            "title": "Success",
            "type": "boolean"
          },
          "total_rows": {
            "description": "Number of contracts exported",
            "minimum": 0.0,
            "title": "Total Rows",
            "type": "integer"
          },
          "updated_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "ISO 8601 timestamp (only for mode='update')",
            "title": "Updated At"
          }
        },
        "required": [
          "spreadsheet_id",
          "spreadsheet_url",
          "total_rows"
        ],
        "title": "GoogleSheetsExportResponse",
        "type": "object"
      },
      "HTTPValidationError": {
        "properties": {
          "detail": {
            "items": {
              "$ref": "#/components/schemas/ValidationError"
            },
            "title": "Detail",
            "type": "array"
          }
        },
        "title": "HTTPValidationError",
        "type": "object"
      },
      "HealthDependencies": {
        "description": "Health check dependency statuses.",
        "properties": {
          "openai": {
            "title": "Openai",
            "type": "string"
          },
          "redis": {
            "title": "Redis",
            "type": "string"
          },
          "supabase": {
            "title": "Supabase",
            "type": "string"
          }
        },
        "required": [
          "supabase",
          "openai",
          "redis"
        ],
        "title": "HealthDependencies",
        "type": "object"
      },
      "HealthResponse": {
        "description": "Response for GET /health endpoint.",
        "properties": {
          "dependencies": {
            "$ref": "#/components/schemas/HealthDependencies"
          },
          "sources": {
            "anyOf": [
              {
                "additionalProperties": {
                  "type": "string"
                },
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Sources"
          },
          "status": {
            "title": "Status",
            "type": "string"
          },
          "timestamp": {
            "title": "Timestamp",
            "type": "string"
          },
          "version": {
            "title": "Version",
            "type": "string"
          }
        },
        "required": [
          "status",
          "timestamp",
          "version",
          "dependencies"
        ],
        "title": "HealthResponse",
        "type": "object"
      },
      "LicitacaoItem": {
        "description": "Individual bid item for display in search results.\n\nUsed for FREE tier preview feature - shows 5-10 items fully,\nrest are displayed blurred/partial without links.",
        "example": {
          "data_abertura": "2026-02-15",
          "data_publicacao": "2026-02-01",
          "link": "https://pncp.gov.br/app/editais/12345678000190/2026/1",
          "modalidade": "Preg\u00e3o Eletr\u00f4nico",
          "municipio": "S\u00e3o Paulo",
          "objeto": "Aquisi\u00e7\u00e3o de uniformes para funcion\u00e1rios",
          "orgao": "Prefeitura Municipal de S\u00e3o Paulo",
          "pncp_id": "12345678000190-1-000001/2026",
          "uf": "SP",
          "valor": 150000.0
        },
        "properties": {
          "_source": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "Source that provided this record",
            "title": "Source"
          },
          "data_abertura": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "Proposal opening date",
            "title": "Data Abertura"
          },
          "data_encerramento": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "Proposal submission deadline",
            "title": "Data Encerramento"
          },
          "data_publicacao": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "Publication date",
            "title": "Data Publicacao"
          },
          "dias_restantes": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "description": "Days remaining until proposal deadline (negative if past)",
            "title": "Dias Restantes"
          },
          "link": {
            "description": "Direct link to PNCP portal",
            "title": "Link",
            "type": "string"
          },
          "matched_terms": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "description": "List of search terms that matched this bid",
            "title": "Matched Terms"
          },
          "modalidade": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "Procurement modality",
            "title": "Modalidade"
          },
          "municipio": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "Municipality name",
            "title": "Municipio"
          },
          "objeto": {
            "description": "Procurement object description",
            "title": "Objeto",
            "type": "string"
          },
          "orgao": {
            "description": "Government agency name",
            "title": "Orgao",
            "type": "string"
          },
          "pncp_id": {
            "description": "Unique PNCP identifier",
            "title": "Pncp Id",
            "type": "string"
          },
          "relevance_score": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "description": "Relevance score 0.0-1.0 (only when custom terms active)",
            "title": "Relevance Score"
          },
          "supplier_sanctions": {
            "anyOf": [
              {
                "$ref": "#/components/schemas/SanctionsSummarySchema"
              },
              {
                "type": "null"
              }
            ],
            "description": "Sanctions check result (only when check_sanctions=true in request)"
          },
          "uf": {
            "description": "State code (e.g., 'SP')",
            "title": "Uf",
            "type": "string"
          },
          "urgencia": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "Urgency level: critica (<7d), alta (7-14d), media (14-30d), baixa (>30d), encerrada (past)",
            "title": "Urgencia"
          },
          "valor": {
            "description": "Estimated total value in BRL",
            "minimum": 0.0,
            "title": "Valor",
            "type": "number"
          }
        },
        "required": [
          "pncp_id",
          "objeto",
          "orgao",
          "uf",
          "valor",
          "link"
        ],
        "title": "LicitacaoItem",
        "type": "object"
      },
      "MessageResponse": {
        "description": "Single message in a conversation thread.",
        "properties": {
          "body": {
            "title": "Body",
            "type": "string"
          },
          "created_at": {
            "title": "Created At",
            "type": "string"
          },
          "id": {
            "title": "Id",
            "type": "string"
          },
          "is_admin_reply": {
            "title": "Is Admin Reply",
            "type": "boolean"
          },
          "read_by_admin": {
            "title": "Read By Admin",
            "type": "boolean"
          },
          "read_by_user": {
            "title": "Read By User",
            "type": "boolean"
          },
          "sender_email": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Sender Email"
          },
          "sender_id": {
            "title": "Sender Id",
            "type": "string"
          }
        },
        "required": [
          "id",
          "sender_id",
          "body",
          "is_admin_reply",
          "read_by_user",
          "read_by_admin",
          "created_at"
        ],
        "title": "MessageResponse",
        "type": "object"
      },
      "PerfilContexto": {
        "description": "Business context profile collected during onboarding wizard.\n\nUsed to personalize search defaults and LLM recommendations.\nStored as JSONB in profiles.context_data.",
        "properties": {
          "cnae": {
            "anyOf": [
              {
                "maxLength": 20,
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "CNAE code or business segment (e.g., '4781-4/00')",
            "title": "Cnae"
          },
          "experiencia_licitacoes": {
            "$ref": "#/components/schemas/ExperienciaLicitacoes",
            "description": "Procurement experience level"
          },
          "faixa_valor_max": {
            "anyOf": [
              {
                "minimum": 0.0,
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "description": "Maximum contract value of interest (BRL)",
            "title": "Faixa Valor Max"
          },
          "faixa_valor_min": {
            "anyOf": [
              {
                "minimum": 0.0,
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "description": "Minimum contract value of interest (BRL)",
            "title": "Faixa Valor Min"
          },
          "modalidades_interesse": {
            "anyOf": [
              {
                "items": {
                  "type": "integer"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "description": "Preferred procurement modality codes (PNCP API codes)",
            "title": "Modalidades Interesse"
          },
          "objetivo_principal": {
            "anyOf": [
              {
                "maxLength": 200,
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "User's primary objective in free text",
            "title": "Objetivo Principal"
          },
          "palavras_chave": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "maxItems": 20,
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "description": "Business-specific keywords for relevance boosting",
            "title": "Palavras Chave"
          },
          "porte_empresa": {
            "$ref": "#/components/schemas/PorteEmpresa",
            "description": "Company size: ME, EPP, MEDIO, GRANDE"
          },
          "ticket_medio_desejado": {
            "anyOf": [
              {
                "minimum": 0.0,
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "description": "Desired average ticket in BRL cents",
            "title": "Ticket Medio Desejado"
          },
          "ufs_atuacao": {
            "description": "States where the company operates (e.g., ['SP', 'RJ', 'MG'])",
            "examples": [
              [
                "SP",
                "RJ"
              ]
            ],
            "items": {
              "type": "string"
            },
            "maxItems": 27,
            "minItems": 1,
            "title": "Ufs Atuacao",
            "type": "array"
          }
        },
        "required": [
          "ufs_atuacao",
          "porte_empresa",
          "experiencia_licitacoes"
        ],
        "title": "PerfilContexto",
        "type": "object"
      },
      "PerfilContextoResponse": {
        "description": "Response for GET /v1/profile/context.",
        "properties": {
          "completed": {
            "default": false,
            "description": "Whether onboarding wizard has been completed",
            "title": "Completed",
            "type": "boolean"
          },
          "context_data": {
            "additionalProperties": true,
            "description": "Business context data from onboarding",
            "title": "Context Data",
            "type": "object"
          }
        },
        "title": "PerfilContextoResponse",
        "type": "object"
      },
      "PipelineAlertsResponse": {
        "description": "Pipeline items with approaching deadlines.",
        "properties": {
          "items": {
            "items": {
              "$ref": "#/components/schemas/PipelineItemResponse"
            },
            "title": "Items",
            "type": "array"
          },
          "total": {
            "title": "Total",
            "type": "integer"
          }
        },
        "required": [
          "items",
          "total"
        ],
        "title": "PipelineAlertsResponse",
        "type": "object"
      },
      "PipelineItemCreate": {
        "description": "Request to add an item to the pipeline.",
        "properties": {
          "data_encerramento": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "Deadline ISO timestamp",
            "title": "Data Encerramento"
          },
          "link_pncp": {
            "anyOf": [
              {
                "maxLength": 500,
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "Direct PNCP link",
            "title": "Link Pncp"
          },
          "notes": {
            "anyOf": [
              {
                "maxLength": 5000,
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "User notes",
            "title": "Notes"
          },
          "objeto": {
            "description": "Procurement object description",
            "maxLength": 2000,
            "minLength": 1,
            "title": "Objeto",
            "type": "string"
          },
          "orgao": {
            "anyOf": [
              {
                "maxLength": 500,
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "Government agency name",
            "title": "Orgao"
          },
          "pncp_id": {
            "description": "PNCP unique identifier",
            "maxLength": 100,
            "minLength": 1,
            "title": "Pncp Id",
            "type": "string"
          },
          "stage": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": "descoberta",
            "description": "Initial pipeline stage",
            "title": "Stage"
          },
          "uf": {
            "anyOf": [
              {
                "maxLength": 2,
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "State code",
            "title": "Uf"
          },
          "valor_estimado": {
            "anyOf": [
              {
                "minimum": 0.0,
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "description": "Estimated value in BRL",
            "title": "Valor Estimado"
          }
        },
        "required": [
          "pncp_id",
          "objeto"
        ],
        "title": "PipelineItemCreate",
        "type": "object"
      },
      "PipelineItemResponse": {
        "description": "Single pipeline item response.",
        "properties": {
          "created_at": {
            "title": "Created At",
            "type": "string"
          },
          "data_encerramento": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Data Encerramento"
          },
          "id": {
            "title": "Id",
            "type": "string"
          },
          "link_pncp": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Link Pncp"
          },
          "notes": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Notes"
          },
          "objeto": {
            "title": "Objeto",
            "type": "string"
          },
          "orgao": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Orgao"
          },
          "pncp_id": {
            "title": "Pncp Id",
            "type": "string"
          },
          "stage": {
            "title": "Stage",
            "type": "string"
          },
          "uf": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Uf"
          },
          "updated_at": {
            "title": "Updated At",
            "type": "string"
          },
          "user_id": {
            "title": "User Id",
            "type": "string"
          },
          "valor_estimado": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Valor Estimado"
          }
        },
        "required": [
          "id",
          "user_id",
          "pncp_id",
          "objeto",
          "stage",
          "created_at",
          "updated_at"
        ],
        "title": "PipelineItemResponse",
        "type": "object"
      },
      "PipelineItemUpdate": {
        "description": "Request to update a pipeline item (stage and/or notes).",
        "properties": {
          "notes": {
            "anyOf": [
              {
                "maxLength": 5000,
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "Updated notes",
            "title": "Notes"
          },
          "stage": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "New pipeline stage",
            "title": "Stage"
          }
        },
        "title": "PipelineItemUpdate",
        "type": "object"
      },
      "PipelineListResponse": {
        "description": "Paginated list of pipeline items.",
        "properties": {
          "items": {
            "items": {
              "$ref": "#/components/schemas/PipelineItemResponse"
            },
            "title": "Items",
            "type": "array"
          },
          "limit": {
            "title": "Limit",
            "type": "integer"
          },
          "offset": {
            "title": "Offset",
            "type": "integer"
          },
          "total": {
            "title": "Total",
            "type": "integer"
          }
        },
        "required": [
          "items",
          "total",
          "limit",
          "offset"
        ],
        "title": "PipelineListResponse",
        "type": "object"
      },
      "PlanDetails": {
        "description": "Complete plan details for frontend display.\n\nSTORY-210 AC11: Stripe Price IDs removed from public response\nto prevent enumeration attacks on pricing infrastructure.",
        "properties": {
          "capabilities": {
            "additionalProperties": true,
            "title": "Capabilities",
            "type": "object"
          },
          "description": {
            "title": "Description",
            "type": "string"
          },
          "duration_days": {
            "title": "Duration Days",
            "type": "integer"
          },
          "id": {
            "title": "Id",
            "type": "string"
          },
          "is_active": {
            "title": "Is Active",
            "type": "boolean"
          },
          "max_searches": {
            "title": "Max Searches",
            "type": "integer"
          },
          "name": {
            "title": "Name",
            "type": "string"
          },
          "price_brl": {
            "title": "Price Brl",
            "type": "number"
          }
        },
        "required": [
          "id",
          "name",
          "description",
          "price_brl",
          "duration_days",
          "max_searches",
          "capabilities",
          "is_active"
        ],
        "title": "PlanDetails",
        "type": "object"
      },
      "PlansResponse": {
        "description": "Response model for GET /api/plans.",
        "properties": {
          "plans": {
            "items": {
              "$ref": "#/components/schemas/PlanDetails"
            },
            "title": "Plans",
            "type": "array"
          },
          "total": {
            "title": "Total",
            "type": "integer"
          }
        },
        "required": [
          "plans",
          "total"
        ],
        "title": "PlansResponse",
        "type": "object"
      },
      "PorteEmpresa": {
        "description": "Company size classification.",
        "enum": [
          "ME",
          "EPP",
          "MEDIO",
          "GRANDE"
        ],
        "title": "PorteEmpresa",
        "type": "string"
      },
      "Recomendacao": {
        "description": "Actionable recommendation for a specific procurement opportunity.\n\nGenerated by the LLM consultant or heuristic fallback.\nEach recommendation includes a concrete action and justification.",
        "properties": {
          "acao_sugerida": {
            "description": "Concrete suggested action",
            "examples": [
              "Prepare documenta\u00e7\u00e3o at\u00e9 17/02. Prazo final para propostas em 3 dias."
            ],
            "title": "Acao Sugerida",
            "type": "string"
          },
          "justificativa": {
            "description": "Why this opportunity is relevant",
            "examples": [
              "Valor compat\u00edvel com seu porte, \u00f3rg\u00e3o federal com bom hist\u00f3rico de pagamento."
            ],
            "title": "Justificativa",
            "type": "string"
          },
          "oportunidade": {
            "description": "Opportunity name (agency/object)",
            "examples": [
              "Prefeitura de Porto Alegre - Uniformes Escolares"
            ],
            "title": "Oportunidade",
            "type": "string"
          },
          "urgencia": {
            "description": "Urgency level: alta (<3 days), media (3-7 days), baixa (>7 days)",
            "enum": [
              "alta",
              "media",
              "baixa"
            ],
            "title": "Urgencia",
            "type": "string"
          },
          "valor": {
            "description": "Estimated value in BRL",
            "minimum": 0.0,
            "title": "Valor",
            "type": "number"
          }
        },
        "required": [
          "oportunidade",
          "valor",
          "urgencia",
          "acao_sugerida",
          "justificativa"
        ],
        "title": "Recomendacao",
        "type": "object"
      },
      "ReplyRequest": {
        "description": "Request to reply to a conversation.",
        "properties": {
          "body": {
            "maxLength": 5000,
            "minLength": 1,
            "title": "Body",
            "type": "string"
          }
        },
        "required": [
          "body"
        ],
        "title": "ReplyRequest",
        "type": "object"
      },
      "ReplyStatusResponse": {
        "description": "Response for POST /api/messages/conversations/{id}/reply.",
        "properties": {
          "status": {
            "title": "Status",
            "type": "string"
          }
        },
        "required": [
          "status"
        ],
        "title": "ReplyStatusResponse",
        "type": "object"
      },
      "ResendRequest": {
        "properties": {
          "email": {
            "format": "email",
            "title": "Email",
            "type": "string"
          }
        },
        "required": [
          "email"
        ],
        "title": "ResendRequest",
        "type": "object"
      },
      "ResendResponse": {
        "properties": {
          "message": {
            "title": "Message",
            "type": "string"
          },
          "success": {
            "title": "Success",
            "type": "boolean"
          }
        },
        "required": [
          "success",
          "message"
        ],
        "title": "ResendResponse",
        "type": "object"
      },
      "ResumoEstrategico": {
        "description": "Strategic executive summary with actionable recommendations.\n\nExtends ResumoLicitacoes for backward compatibility \u2014 all original fields\n(resumo_executivo, total_oportunidades, valor_total, destaques, alerta_urgencia)\nremain present. New fields provide actionable intelligence.\n\nFields:\n    recomendacoes: Prioritized list of recommended opportunities with actions\n    alertas_urgencia: Multiple urgency alerts (replaces single alerta_urgencia)\n    insight_setorial: Sector-level market context and trends",
        "example": {
          "alerta_urgencia": "\u26a0\ufe0f 5 licita\u00e7\u00f5es encerram em 24 horas",
          "alertas_urgencia": [
            "\u26a0\ufe0f 2 licita\u00e7\u00f5es encerram em 48h \u2014 a\u00e7\u00e3o imediata necess\u00e1ria",
            "\ud83d\udccb Edital de SP exige certid\u00e3o FGTS atualizada (verificar validade)"
          ],
          "destaques": [
            "3 licita\u00e7\u00f5es encerram em menos de 72h",
            "Maior valor: R$ 500k em SP"
          ],
          "insight_setorial": "O setor de vestu\u00e1rio apresenta 15 oportunidades esta semana, 25% acima da m\u00e9dia mensal. Concentra\u00e7\u00e3o em SP e RJ sugere demanda sazonal por uniformes escolares.",
          "recomendacoes": [
            {
              "acao_sugerida": "Prepare documenta\u00e7\u00e3o at\u00e9 16/02. Exige certid\u00e3o negativa atualizada.",
              "justificativa": "Maior valor do lote, \u00f3rg\u00e3o municipal com bom hist\u00f3rico de pagamento.",
              "oportunidade": "Prefeitura de S\u00e3o Paulo - Uniformes Escolares",
              "urgencia": "alta",
              "valor": 500000.0
            }
          ],
          "resumo_executivo": "Encontradas 15 licita\u00e7\u00f5es de vestu\u00e1rio em SP e RJ, totalizando R$ 2.3M. Recomendamos aten\u00e7\u00e3o imediata a 3 oportunidades com prazo curto.",
          "total_oportunidades": 15,
          "valor_total": 2300000.0
        },
        "properties": {
          "alerta_urgencia": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "Optional urgency alert for time-sensitive opportunities",
            "examples": [
              "\u26a0\ufe0f 5 licita\u00e7\u00f5es encerram em 24 horas"
            ],
            "title": "Alerta Urgencia"
          },
          "alertas_urgencia": {
            "description": "Multiple urgency alerts for time-sensitive opportunities",
            "examples": [
              [
                "\u26a0\ufe0f 2 licita\u00e7\u00f5es encerram em 48h",
                "\ud83d\udccb 3 editais exigem certid\u00e3o atualizada"
              ]
            ],
            "items": {
              "type": "string"
            },
            "title": "Alertas Urgencia",
            "type": "array"
          },
          "destaques": {
            "description": "Key highlights (2-5 bullet points)",
            "examples": [
              [
                "3 licita\u00e7\u00f5es com prazo at\u00e9 48h",
                "Maior valor: R$ 500k em SP"
              ]
            ],
            "items": {
              "type": "string"
            },
            "title": "Destaques",
            "type": "array"
          },
          "insight_setorial": {
            "default": "",
            "description": "Sector-level market context and trend insight",
            "examples": [
              "Este m\u00eas h\u00e1 20% mais oportunidades de vestu\u00e1rio que o m\u00eas anterior no RS."
            ],
            "title": "Insight Setorial",
            "type": "string"
          },
          "recomendacoes": {
            "description": "Prioritized list of recommended opportunities with concrete actions",
            "items": {
              "$ref": "#/components/schemas/Recomendacao"
            },
            "title": "Recomendacoes",
            "type": "array"
          },
          "resumo_executivo": {
            "description": "1-2 sentence executive summary",
            "examples": [
              "Encontradas 15 licita\u00e7\u00f5es de uniformes em SP e RJ, totalizando R$ 2.3M."
            ],
            "title": "Resumo Executivo",
            "type": "string"
          },
          "total_oportunidades": {
            "description": "Number of procurement opportunities found",
            "minimum": 0.0,
            "title": "Total Oportunidades",
            "type": "integer"
          },
          "valor_total": {
            "description": "Total value of all opportunities in BRL",
            "minimum": 0.0,
            "title": "Valor Total",
            "type": "number"
          }
        },
        "required": [
          "resumo_executivo",
          "total_oportunidades",
          "valor_total"
        ],
        "title": "ResumoEstrategico",
        "type": "object"
      },
      "RevokeResponse": {
        "description": "Response for revoke endpoint.",
        "properties": {
          "message": {
            "title": "Message",
            "type": "string"
          },
          "success": {
            "title": "Success",
            "type": "boolean"
          }
        },
        "required": [
          "success",
          "message"
        ],
        "title": "RevokeResponse",
        "type": "object"
      },
      "RootResponse": {
        "description": "Response for GET / root endpoint.",
        "properties": {
          "api_version": {
            "title": "Api Version",
            "type": "string"
          },
          "description": {
            "title": "Description",
            "type": "string"
          },
          "endpoints": {
            "additionalProperties": {
              "type": "string"
            },
            "title": "Endpoints",
            "type": "object"
          },
          "name": {
            "title": "Name",
            "type": "string"
          },
          "status": {
            "title": "Status",
            "type": "string"
          },
          "version": {
            "title": "Version",
            "type": "string"
          },
          "versioning": {
            "additionalProperties": true,
            "title": "Versioning",
            "type": "object"
          }
        },
        "required": [
          "name",
          "version",
          "api_version",
          "description",
          "endpoints",
          "versioning",
          "status"
        ],
        "title": "RootResponse",
        "type": "object"
      },
      "SanctionsSummarySchema": {
        "description": "Lightweight sanctions summary for search result enrichment (STORY-256 AC11).\n\nShown as a badge on each search result when check_sanctions=true.",
        "properties": {
          "active_sanctions_count": {
            "default": 0,
            "description": "Number of active sanctions",
            "title": "Active Sanctions Count",
            "type": "integer"
          },
          "checked_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "ISO timestamp of check",
            "title": "Checked At"
          },
          "is_clean": {
            "description": "True if no active sanctions found",
            "title": "Is Clean",
            "type": "boolean"
          },
          "sanction_types": {
            "description": "e.g. ['CEIS: Impedimento', 'CNEP: Multa']",
            "items": {
              "type": "string"
            },
            "title": "Sanction Types",
            "type": "array"
          }
        },
        "required": [
          "is_clean"
        ],
        "title": "SanctionsSummarySchema",
        "type": "object"
      },
      "SearchesOverTimeResponse": {
        "properties": {
          "data": {
            "items": {
              "$ref": "#/components/schemas/TimeSeriesDataPoint"
            },
            "title": "Data",
            "type": "array"
          },
          "period": {
            "title": "Period",
            "type": "string"
          }
        },
        "required": [
          "period",
          "data"
        ],
        "title": "SearchesOverTimeResponse",
        "type": "object"
      },
      "SessionsListResponse": {
        "description": "Response for GET /sessions.",
        "properties": {
          "limit": {
            "title": "Limit",
            "type": "integer"
          },
          "offset": {
            "title": "Offset",
            "type": "integer"
          },
          "sessions": {
            "items": {
              "additionalProperties": true,
              "type": "object"
            },
            "title": "Sessions",
            "type": "array"
          },
          "total": {
            "title": "Total",
            "type": "integer"
          }
        },
        "required": [
          "sessions",
          "total",
          "limit",
          "offset"
        ],
        "title": "SessionsListResponse",
        "type": "object"
      },
      "SetoresResponse": {
        "description": "Response for GET /setores endpoint.",
        "properties": {
          "setores": {
            "items": {
              "additionalProperties": true,
              "type": "object"
            },
            "title": "Setores",
            "type": "array"
          }
        },
        "required": [
          "setores"
        ],
        "title": "SetoresResponse",
        "type": "object"
      },
      "SourceInfo": {
        "description": "Individual data source health info.",
        "properties": {
          "code": {
            "title": "Code",
            "type": "string"
          },
          "enabled": {
            "title": "Enabled",
            "type": "boolean"
          },
          "name": {
            "title": "Name",
            "type": "string"
          },
          "priority": {
            "title": "Priority",
            "type": "integer"
          },
          "response_ms": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Response Ms"
          },
          "status": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Status"
          }
        },
        "required": [
          "code",
          "name",
          "enabled",
          "priority"
        ],
        "title": "SourceInfo",
        "type": "object"
      },
      "SourcesHealthResponse": {
        "description": "Response for GET /sources/health endpoint.",
        "properties": {
          "checked_at": {
            "title": "Checked At",
            "type": "string"
          },
          "multi_source_enabled": {
            "title": "Multi Source Enabled",
            "type": "boolean"
          },
          "sources": {
            "items": {
              "$ref": "#/components/schemas/SourceInfo"
            },
            "title": "Sources",
            "type": "array"
          },
          "total_available": {
            "title": "Total Available",
            "type": "integer"
          },
          "total_enabled": {
            "title": "Total Enabled",
            "type": "integer"
          }
        },
        "required": [
          "sources",
          "multi_source_enabled",
          "total_enabled",
          "total_available",
          "checked_at"
        ],
        "title": "SourcesHealthResponse",
        "type": "object"
      },
      "StatusLicitacao": {
        "description": "Status da licita\u00e7\u00e3o para filtro de busca.\n\nDefine o est\u00e1gio atual do processo licitat\u00f3rio:\n- RECEBENDO_PROPOSTA: Licita\u00e7\u00f5es abertas para envio de propostas (padr\u00e3o)\n- EM_JULGAMENTO: Propostas encerradas, em an\u00e1lise pelo \u00f3rg\u00e3o\n- ENCERRADA: Processo finalizado (com ou sem vencedor)\n- TODOS: Sem filtro de status (retorna todas)",
        "enum": [
          "recebendo_proposta",
          "em_julgamento",
          "encerrada",
          "todos"
        ],
        "title": "StatusLicitacao",
        "type": "string"
      },
      "StatusResponse": {
        "description": "Generic status response.",
        "properties": {
          "status": {
            "title": "Status",
            "type": "string"
          }
        },
        "required": [
          "status"
        ],
        "title": "StatusResponse",
        "type": "object"
      },
      "SuccessResponse": {
        "description": "Generic success response for simple operations.",
        "properties": {
          "success": {
            "title": "Success",
            "type": "boolean"
          }
        },
        "required": [
          "success"
        ],
        "title": "SuccessResponse",
        "type": "object"
      },
      "SummaryResponse": {
        "properties": {
          "avg_results_per_search": {
            "title": "Avg Results Per Search",
            "type": "number"
          },
          "estimated_hours_saved": {
            "title": "Estimated Hours Saved",
            "type": "number"
          },
          "member_since": {
            "title": "Member Since",
            "type": "string"
          },
          "success_rate": {
            "title": "Success Rate",
            "type": "number"
          },
          "total_downloads": {
            "title": "Total Downloads",
            "type": "integer"
          },
          "total_opportunities": {
            "title": "Total Opportunities",
            "type": "integer"
          },
          "total_searches": {
            "title": "Total Searches",
            "type": "integer"
          },
          "total_value_discovered": {
            "title": "Total Value Discovered",
            "type": "number"
          }
        },
        "required": [
          "total_searches",
          "total_downloads",
          "total_opportunities",
          "total_value_discovered",
          "estimated_hours_saved",
          "avg_results_per_search",
          "success_rate",
          "member_since"
        ],
        "title": "SummaryResponse",
        "type": "object"
      },
      "TimeSeriesDataPoint": {
        "properties": {
          "label": {
            "title": "Label",
            "type": "string"
          },
          "opportunities": {
            "title": "Opportunities",
            "type": "integer"
          },
          "searches": {
            "title": "Searches",
            "type": "integer"
          },
          "value": {
            "title": "Value",
            "type": "number"
          }
        },
        "required": [
          "label",
          "searches",
          "opportunities",
          "value"
        ],
        "title": "TimeSeriesDataPoint",
        "type": "object"
      },
      "TopDimensionsResponse": {
        "properties": {
          "top_sectors": {
            "items": {
              "$ref": "#/components/schemas/DimensionItem"
            },
            "title": "Top Sectors",
            "type": "array"
          },
          "top_ufs": {
            "items": {
              "$ref": "#/components/schemas/DimensionItem"
            },
            "title": "Top Ufs",
            "type": "array"
          }
        },
        "required": [
          "top_ufs",
          "top_sectors"
        ],
        "title": "TopDimensionsResponse",
        "type": "object"
      },
      "TopOpportunity": {
        "properties": {
          "title": {
            "title": "Title",
            "type": "string"
          },
          "value": {
            "title": "Value",
            "type": "number"
          }
        },
        "required": [
          "title",
          "value"
        ],
        "title": "TopOpportunity",
        "type": "object"
      },
      "TrialStatusResponse": {
        "properties": {
          "days_remaining": {
            "title": "Days Remaining",
            "type": "integer"
          },
          "expires_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Expires At"
          },
          "is_expired": {
            "title": "Is Expired",
            "type": "boolean"
          },
          "plan": {
            "title": "Plan",
            "type": "string"
          },
          "searches_limit": {
            "title": "Searches Limit",
            "type": "integer"
          },
          "searches_used": {
            "title": "Searches Used",
            "type": "integer"
          }
        },
        "required": [
          "plan",
          "days_remaining",
          "searches_used",
          "searches_limit",
          "is_expired"
        ],
        "title": "TrialStatusResponse",
        "type": "object"
      },
      "TrialValueResponse": {
        "properties": {
          "avg_opportunity_value": {
            "title": "Avg Opportunity Value",
            "type": "number"
          },
          "searches_executed": {
            "title": "Searches Executed",
            "type": "integer"
          },
          "top_opportunity": {
            "anyOf": [
              {
                "$ref": "#/components/schemas/TopOpportunity"
              },
              {
                "type": "null"
              }
            ]
          },
          "total_opportunities": {
            "title": "Total Opportunities",
            "type": "integer"
          },
          "total_value": {
            "title": "Total Value",
            "type": "number"
          }
        },
        "required": [
          "total_opportunities",
          "total_value",
          "searches_executed",
          "avg_opportunity_value"
        ],
        "title": "TrialValueResponse",
        "type": "object"
      },
      "UnreadCountResponse": {
        "description": "Unread message count for badge display.",
        "properties": {
          "unread_count": {
            "title": "Unread Count",
            "type": "integer"
          }
        },
        "required": [
          "unread_count"
        ],
        "title": "UnreadCountResponse",
        "type": "object"
      },
      "UpdateBillingPeriodRequest": {
        "description": "Request to update subscription billing period.",
        "properties": {
          "new_billing_period": {
            "description": "Target billing period",
            "enum": [
              "monthly",
              "semiannual",
              "annual"
            ],
            "title": "New Billing Period",
            "type": "string"
          }
        },
        "required": [
          "new_billing_period"
        ],
        "title": "UpdateBillingPeriodRequest",
        "type": "object"
      },
      "UpdateBillingPeriodResponse": {
        "description": "Response for billing period update.",
        "properties": {
          "message": {
            "title": "Message",
            "type": "string"
          },
          "new_billing_period": {
            "title": "New Billing Period",
            "type": "string"
          },
          "next_billing_date": {
            "title": "Next Billing Date",
            "type": "string"
          },
          "success": {
            "title": "Success",
            "type": "boolean"
          }
        },
        "required": [
          "success",
          "new_billing_period",
          "next_billing_date",
          "message"
        ],
        "title": "UpdateBillingPeriodResponse",
        "type": "object"
      },
      "UpdateConversationStatusRequest": {
        "description": "Request to update conversation status (admin only).",
        "properties": {
          "status": {
            "$ref": "#/components/schemas/ConversationStatus"
          }
        },
        "required": [
          "status"
        ],
        "title": "UpdateConversationStatusRequest",
        "type": "object"
      },
      "UpdateCreditsRequest": {
        "description": "Request body for manual credit adjustment.",
        "properties": {
          "credits": {
            "description": "New credit value (must be >= 0)",
            "minimum": 0.0,
            "title": "Credits",
            "type": "integer"
          }
        },
        "required": [
          "credits"
        ],
        "title": "UpdateCreditsRequest",
        "type": "object"
      },
      "UpdateUserRequest": {
        "properties": {
          "company": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Company"
          },
          "full_name": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Full Name"
          },
          "plan_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Plan Id"
          }
        },
        "title": "UpdateUserRequest",
        "type": "object"
      },
      "UserFeaturesResponse": {
        "description": "Response containing user's enabled features.",
        "properties": {
          "billing_period": {
            "title": "Billing Period",
            "type": "string"
          },
          "cached_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Cached At"
          },
          "features": {
            "items": {
              "$ref": "#/components/schemas/FeatureInfo"
            },
            "title": "Features",
            "type": "array"
          },
          "plan_id": {
            "title": "Plan Id",
            "type": "string"
          }
        },
        "required": [
          "features",
          "plan_id",
          "billing_period"
        ],
        "title": "UserFeaturesResponse",
        "type": "object"
      },
      "UserProfileResponse": {
        "description": "User profile with plan capabilities and quota status.\n\nReturned by /api/me endpoint to provide frontend with all\nnecessary plan information for UI rendering.",
        "properties": {
          "capabilities": {
            "additionalProperties": true,
            "description": "Plan capabilities (max_history_days, allow_excel, etc.)",
            "title": "Capabilities",
            "type": "object"
          },
          "email": {
            "title": "Email",
            "type": "string"
          },
          "is_admin": {
            "default": false,
            "description": "Whether user has admin privileges",
            "title": "Is Admin",
            "type": "boolean"
          },
          "plan_id": {
            "description": "Plan ID (e.g., 'consultor_agil')",
            "title": "Plan Id",
            "type": "string"
          },
          "plan_name": {
            "description": "Display name (e.g., 'Consultor \u00c1gil')",
            "title": "Plan Name",
            "type": "string"
          },
          "quota_remaining": {
            "description": "Searches remaining this month",
            "minimum": 0.0,
            "title": "Quota Remaining",
            "type": "integer"
          },
          "quota_reset_date": {
            "description": "ISO 8601 timestamp of next quota reset",
            "title": "Quota Reset Date",
            "type": "string"
          },
          "quota_used": {
            "description": "Searches used this month",
            "minimum": 0.0,
            "title": "Quota Used",
            "type": "integer"
          },
          "subscription_status": {
            "description": "Status: 'trial', 'active', or 'expired'",
            "title": "Subscription Status",
            "type": "string"
          },
          "trial_expires_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "ISO 8601 timestamp when trial expires (if applicable)",
            "title": "Trial Expires At"
          },
          "user_id": {
            "title": "User Id",
            "type": "string"
          }
        },
        "required": [
          "user_id",
          "email",
          "plan_id",
          "plan_name",
          "capabilities",
          "quota_used",
          "quota_remaining",
          "quota_reset_date",
          "subscription_status"
        ],
        "title": "UserProfileResponse",
        "type": "object"
      },
      "ValidationError": {
        "properties": {
          "ctx": {
            "title": "Context",
            "type": "object"
          },
          "input": {
            "title": "Input"
          },
          "loc": {
            "items": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "integer"
                }
              ]
            },
            "title": "Location",
            "type": "array"
          },
          "msg": {
            "title": "Message",
            "type": "string"
          },
          "type": {
            "title": "Error Type",
            "type": "string"
          }
        },
        "required": [
          "loc",
          "msg",
          "type"
        ],
        "title": "ValidationError",
        "type": "object"
      },
      "WelcomeEmailResponse": {
        "properties": {
          "message": {
            "title": "Message",
            "type": "string"
          },
          "sent": {
            "title": "Sent",
            "type": "boolean"
          }
        },
        "required": [
          "sent",
          "message"
        ],
        "title": "WelcomeEmailResponse",
        "type": "object"
      }
    },
    "securitySchemes": {
      "HTTPBearer": {
        "scheme": "bearer",
        "type": "http"
      }
    }
  },
  "info": {
    "description": "API para busca e an\u00e1lise de licita\u00e7\u00f5es em fontes oficiais. Permite filtrar oportunidades por estado, valor e setor, gerando relat\u00f3rios Excel e avalia\u00e7\u00e3o estrat\u00e9gica via IA.",
    "title": "BidIQ Uniformes API",
    "version": "0.2.0"
  },
  "openapi": "3.1.0",
  "paths": {
    "/": {
      "get": {
        "description": "API root endpoint - provides navigation to documentation.\n\nSYS-M08: Informs clients about API versioning.",
        "operationId": "root__get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RootResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "summary": "Root"
      }
    },
    "/admin/admin/filter-stats": {
      "get": {
        "description": "STORY-248 AC10: Filter rejection statistics.\n\nReturns counts of each rejection reason code for the specified period.\nAdmin-only endpoint.\n\nReason codes:\n- keyword_miss: No sector keyword found in procurement description\n- exclusion_hit: Exclusion keyword matched (false-positive prevention)\n- llm_reject: LLM arbiter rejected the contract\n- density_low: Term density below minimum threshold\n- value_exceed: Contract value exceeds sector maximum\n- uf_mismatch: State (UF) not in selected set\n- status_mismatch: Procurement status does not match filter",
        "operationId": "get_filter_stats_admin_admin_filter_stats_get",
        "parameters": [
          {
            "description": "Number of days to look back",
            "in": "query",
            "name": "days",
            "required": false,
            "schema": {
              "default": 7,
              "description": "Number of days to look back",
              "maximum": 90,
              "minimum": 1,
              "title": "Days",
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Filter Stats",
        "tags": [
          "admin"
        ]
      }
    },
    "/admin/feature-flags/reload": {
      "post": {
        "description": "Reload all feature flags from environment variables (admin only).\n\nSTORY-226 AC16: Clears the feature flag cache, forcing re-read from\nenvironment on next access. Returns current values after reload.",
        "operationId": "reload_feature_flags_endpoint_admin_feature_flags_reload_post",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Reload Feature Flags Endpoint",
        "tags": [
          "admin"
        ]
      }
    },
    "/admin/users": {
      "get": {
        "description": "List all users with profiles and subscription info.",
        "operationId": "list_users_admin_users_get",
        "parameters": [
          {
            "in": "query",
            "name": "limit",
            "required": false,
            "schema": {
              "default": 50,
              "maximum": 200,
              "minimum": 1,
              "title": "Limit",
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "offset",
            "required": false,
            "schema": {
              "default": 0,
              "minimum": 0,
              "title": "Offset",
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "search",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "maxLength": 100,
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "title": "Search"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminUsersListResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "List Users",
        "tags": [
          "admin"
        ]
      },
      "post": {
        "description": "Create a new user with optional plan assignment.",
        "operationId": "create_user_admin_users_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateUserRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminCreateUserResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Create User",
        "tags": [
          "admin"
        ]
      }
    },
    "/admin/users/{user_id}": {
      "delete": {
        "description": "Delete a user and all their data.",
        "operationId": "delete_user_admin_users__user_id__delete",
        "parameters": [
          {
            "description": "User UUID to delete",
            "in": "path",
            "name": "user_id",
            "required": true,
            "schema": {
              "description": "User UUID to delete",
              "title": "User Id",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminDeleteUserResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Delete User",
        "tags": [
          "admin"
        ]
      },
      "put": {
        "description": "Update user profile or plan.",
        "operationId": "update_user_admin_users__user_id__put",
        "parameters": [
          {
            "description": "User UUID to update",
            "in": "path",
            "name": "user_id",
            "required": true,
            "schema": {
              "description": "User UUID to update",
              "title": "User Id",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateUserRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminUpdateUserResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Update User",
        "tags": [
          "admin"
        ]
      }
    },
    "/admin/users/{user_id}/assign-plan": {
      "post": {
        "description": "Manually assign a plan to a user (bypasses payment).",
        "operationId": "assign_plan_admin_users__user_id__assign_plan_post",
        "parameters": [
          {
            "description": "User UUID to assign plan to",
            "in": "path",
            "name": "user_id",
            "required": true,
            "schema": {
              "description": "User UUID to assign plan to",
              "title": "User Id",
              "type": "string"
            }
          },
          {
            "description": "Plan ID to assign",
            "in": "query",
            "name": "plan_id",
            "required": true,
            "schema": {
              "description": "Plan ID to assign",
              "title": "Plan Id",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminAssignPlanResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Assign Plan",
        "tags": [
          "admin"
        ]
      }
    },
    "/admin/users/{user_id}/credits": {
      "put": {
        "description": "Manually adjust a user's credits (admin only).\n\nSets the credits_remaining value directly on the user's active subscription.\nIf no active subscription exists, creates one based on user's current plan.\n\nArgs:\n    user_id: UUID of the user\n    req.credits: New credit value (must be >= 0)\n\nReturns:\n    Updated user info with new credit value",
        "operationId": "update_user_credits_admin_users__user_id__credits_put",
        "parameters": [
          {
            "description": "User UUID to update credits for",
            "in": "path",
            "name": "user_id",
            "required": true,
            "schema": {
              "description": "User UUID to update credits for",
              "title": "User Id",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateCreditsRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminUpdateCreditsResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Update User Credits",
        "tags": [
          "admin"
        ]
      }
    },
    "/admin/users/{user_id}/reset-password": {
      "post": {
        "description": "Reset a user's password (admin only).",
        "operationId": "reset_user_password_admin_users__user_id__reset_password_post",
        "parameters": [
          {
            "description": "User UUID to reset password for",
            "in": "path",
            "name": "user_id",
            "required": true,
            "schema": {
              "description": "User UUID to reset password for",
              "title": "User Id",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminResetPasswordResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Reset User Password",
        "tags": [
          "admin"
        ]
      }
    },
    "/analytics/searches-over-time": {
      "get": {
        "description": "Get time-series search data grouped by period.",
        "operationId": "get_searches_over_time_analytics_searches_over_time_get",
        "parameters": [
          {
            "in": "query",
            "name": "period",
            "required": false,
            "schema": {
              "default": "week",
              "pattern": "^(day|week|month)$",
              "title": "Period",
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "range_days",
            "required": false,
            "schema": {
              "default": 90,
              "maximum": 365,
              "minimum": 1,
              "title": "Range Days",
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchesOverTimeResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Searches Over Time",
        "tags": [
          "analytics"
        ]
      }
    },
    "/analytics/summary": {
      "get": {
        "description": "Get overall user analytics summary.",
        "operationId": "get_analytics_summary_analytics_summary_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SummaryResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Analytics Summary",
        "tags": [
          "analytics"
        ]
      }
    },
    "/analytics/top-dimensions": {
      "get": {
        "description": "Get top UFs and sectors by search count.",
        "operationId": "get_top_dimensions_analytics_top_dimensions_get",
        "parameters": [
          {
            "in": "query",
            "name": "limit",
            "required": false,
            "schema": {
              "default": 5,
              "maximum": 50,
              "minimum": 1,
              "title": "Limit",
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TopDimensionsResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Top Dimensions",
        "tags": [
          "analytics"
        ]
      }
    },
    "/analytics/trial-value": {
      "get": {
        "description": "Get value generated during trial period (GTM-010 AC1).\n\nReturns aggregated statistics of opportunities analyzed during the user's trial.\nUsed by TrialConversionScreen to show personalized conversion messaging.",
        "operationId": "get_trial_value_analytics_trial_value_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TrialValueResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Trial Value",
        "tags": [
          "analytics"
        ]
      }
    },
    "/api/auth/google": {
      "delete": {
        "description": "Revoke Google OAuth access and delete tokens.\n\nDeletes user's OAuth tokens from database and revokes access with Google.\n\nReturns:\n    {\n        \"success\": true,\n        \"message\": \"Google Sheets access revoked successfully\"\n    }\n\nSecurity:\n    - Requires authentication\n    - Only deletes tokens for authenticated user\n    - Revokes with Google API (best effort)\n\nNote:\n    Revoking access does NOT delete existing spreadsheets.\n    Spreadsheets remain in user's Google Drive.",
        "operationId": "google_oauth_revoke_api_auth_google_delete",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RevokeResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Google Oauth Revoke",
        "tags": [
          "oauth"
        ]
      },
      "get": {
        "description": "Initiate Google OAuth 2.0 flow.\n\nRedirects user to Google consent screen to authorize Google Sheets access.\n\nQuery Parameters:\n    redirect: Frontend path to return to after authorization\n\nReturns:\n    302 Redirect to Google OAuth consent screen\n\nSecurity:\n    - CSRF protection via state parameter\n    - State encodes user_id + redirect path\n    - Validates state on callback\n\nExample:\n    GET /api/auth/google?redirect=/buscar\n    \u2192 Redirects to https://accounts.google.com/o/oauth2/auth?...",
        "operationId": "google_oauth_initiate_api_auth_google_get",
        "parameters": [
          {
            "description": "Page to return to after auth",
            "in": "query",
            "name": "redirect",
            "required": false,
            "schema": {
              "default": "/buscar",
              "description": "Page to return to after auth",
              "title": "Redirect",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Google Oauth Initiate",
        "tags": [
          "oauth"
        ]
      }
    },
    "/api/auth/google/callback": {
      "get": {
        "description": "Handle OAuth callback from Google.\n\nThis endpoint is called by Google after user authorizes access.\n\nQuery Parameters:\n    code: Authorization code (exchanged for tokens), absent on error\n    state: CSRF state token (contains user_id + redirect path)\n    error: OAuth error code (if authorization failed)\n\nReturns:\n    302 Redirect to frontend with success/error status\n\nFlow:\n    1. Decode state param to get user_id and redirect path\n    2. Exchange code for tokens (access + refresh)\n    3. Encrypt and save tokens to database\n    4. Redirect to frontend with success flag\n\nError Handling:\n    - Invalid state \u2192 Redirect with error=invalid_state\n    - Code exchange failed \u2192 Redirect with error=oauth_failed\n    - Database error \u2192 Redirect with error=storage_failed",
        "operationId": "google_oauth_callback_api_auth_google_callback_get",
        "parameters": [
          {
            "description": "Authorization code from Google",
            "in": "query",
            "name": "code",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Authorization code from Google",
              "title": "Code"
            }
          },
          {
            "description": "CSRF state token",
            "in": "query",
            "name": "state",
            "required": true,
            "schema": {
              "description": "CSRF state token",
              "title": "State",
              "type": "string"
            }
          },
          {
            "description": "OAuth error (if any)",
            "in": "query",
            "name": "error",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "OAuth error (if any)",
              "title": "Error"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "summary": "Google Oauth Callback",
        "tags": [
          "oauth"
        ]
      }
    },
    "/api/export/google-sheets": {
      "post": {
        "description": "Export search results to Google Sheets.\n\nCreates a new Google Sheets spreadsheet or updates an existing one\nwith search results. Applies professional formatting (green header,\ncurrency symbols, hyperlinks).\n\nRequest Body:\n    {\n        \"licitacoes\": [...],\n        \"title\": \"SmartLic - Uniformes - 09/02/2026\",\n        \"mode\": \"create\" | \"update\",\n        \"spreadsheet_id\": \"optional for update mode\"\n    }\n\nReturns:\n    {\n        \"success\": true,\n        \"spreadsheet_id\": \"...\",\n        \"spreadsheet_url\": \"https://docs.google.com/spreadsheets/d/...\",\n        \"total_rows\": 142,\n        \"updated_at\": \"2026-02-09T15:30:00Z\"  // only for update mode\n    }\n\nErrors:\n    401 Unauthorized: User hasn't authorized Google Sheets\n    403 Forbidden: Token revoked or insufficient permissions\n    429 Too Many Requests: Google API quota exceeded\n    500 Internal Server Error: Google API error\n\nExample:\n    POST /api/export/google-sheets\n    {\n        \"licitacoes\": [...],\n        \"title\": \"SmartLic - Uniformes - SP, RJ\",\n        \"mode\": \"create\"\n    }",
        "operationId": "export_to_google_sheets_api_export_google_sheets_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GoogleSheetsExportRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GoogleSheetsExportResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Export To Google Sheets",
        "tags": [
          "export"
        ]
      }
    },
    "/api/export/google-sheets/history": {
      "get": {
        "description": "Get user's Google Sheets export history.\n\nReturns list of all exports with spreadsheet URLs and search parameters.\nUseful for \"re-open last export\" and usage analytics.\n\nQuery Parameters:\n    limit: Maximum number of exports to return (default: 50, max: 100)\n\nReturns:\n    {\n        \"exports\": [\n            {\n                \"id\": \"uuid\",\n                \"spreadsheet_id\": \"...\",\n                \"spreadsheet_url\": \"https://docs.google.com/...\",\n                \"search_params\": {\"ufs\": [\"SP\"], \"setor\": \"Uniformes\"},\n                \"total_rows\": 142,\n                \"created_at\": \"2026-02-09T15:30:00Z\",\n                \"last_updated_at\": \"2026-02-09T15:30:00Z\"\n            }\n        ],\n        \"total\": 1\n    }\n\nExample:\n    GET /api/export/google-sheets/history?limit=20",
        "operationId": "get_export_history_api_export_google_sheets_history_get",
        "parameters": [
          {
            "in": "query",
            "name": "limit",
            "required": false,
            "schema": {
              "default": 50,
              "title": "Limit",
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GoogleSheetsExportHistoryResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Export History",
        "tags": [
          "export"
        ]
      }
    },
    "/api/features/me": {
      "get": {
        "description": "Get current user's enabled features.\n\nCACHING STRATEGY (STORY-217: unified pool):\n- Redis cache with 5-minute TTL via shared pool\n- Cache key: ``features:{user_id}``\n- Cache miss: Fetch from Supabase (JOIN user_subscriptions + plan_features)\n- Graceful degradation via InMemoryCache fallback",
        "operationId": "get_my_features_api_features_me_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserFeaturesResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get My Features",
        "tags": [
          "features"
        ]
      }
    },
    "/api/messages/conversations": {
      "get": {
        "operationId": "list_conversations_api_messages_conversations_get",
        "parameters": [
          {
            "in": "query",
            "name": "status",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "title": "Status"
            }
          },
          {
            "in": "query",
            "name": "limit",
            "required": false,
            "schema": {
              "default": 50,
              "maximum": 100,
              "minimum": 1,
              "title": "Limit",
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "offset",
            "required": false,
            "schema": {
              "default": 0,
              "minimum": 0,
              "title": "Offset",
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ConversationsListResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "List Conversations",
        "tags": [
          "messages"
        ]
      },
      "post": {
        "operationId": "create_conversation_api_messages_conversations_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateConversationRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreateConversationResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Create Conversation",
        "tags": [
          "messages"
        ]
      }
    },
    "/api/messages/conversations/{conversation_id}": {
      "get": {
        "operationId": "get_conversation_api_messages_conversations__conversation_id__get",
        "parameters": [
          {
            "in": "path",
            "name": "conversation_id",
            "required": true,
            "schema": {
              "title": "Conversation Id",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ConversationDetail"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Conversation",
        "tags": [
          "messages"
        ]
      }
    },
    "/api/messages/conversations/{conversation_id}/reply": {
      "post": {
        "operationId": "reply_to_conversation_api_messages_conversations__conversation_id__reply_post",
        "parameters": [
          {
            "in": "path",
            "name": "conversation_id",
            "required": true,
            "schema": {
              "title": "Conversation Id",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ReplyRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReplyStatusResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Reply To Conversation",
        "tags": [
          "messages"
        ]
      }
    },
    "/api/messages/conversations/{conversation_id}/status": {
      "patch": {
        "operationId": "update_conversation_status_api_messages_conversations__conversation_id__status_patch",
        "parameters": [
          {
            "in": "path",
            "name": "conversation_id",
            "required": true,
            "schema": {
              "title": "Conversation Id",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateConversationStatusRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StatusResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Update Conversation Status",
        "tags": [
          "messages"
        ]
      }
    },
    "/api/messages/unread-count": {
      "get": {
        "operationId": "get_unread_count_api_messages_unread_count_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UnreadCountResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Unread Count",
        "tags": [
          "messages"
        ]
      }
    },
    "/api/plans": {
      "get": {
        "description": "Get all active plans with capabilities and pricing.\n\nSTORY-203 CROSS-M01: Combines plan metadata from database with\ncapabilities from SYS-M04 infrastructure. This provides a single\nendpoint for frontend to fetch all plan-related data.\n\nReturns:\n    PlansResponse: List of plans with full details\n\nRaises:\n    HTTPException 500: If database query fails",
        "operationId": "get_plans_with_capabilities_api_plans_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PlansResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "summary": "Get Plans With Capabilities",
        "tags": [
          "plans"
        ]
      }
    },
    "/api/subscriptions/cancel": {
      "post": {
        "description": "Cancel subscription at period end.\n\nGTM-FIX-006: User-initiated cancellation flow.\nSets cancel_at_period_end=True in Stripe, updates status to 'canceling'.",
        "operationId": "cancel_subscription_api_subscriptions_cancel_post",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CancelSubscriptionResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Cancel Subscription",
        "tags": [
          "subscriptions"
        ]
      }
    },
    "/api/subscriptions/update-billing-period": {
      "post": {
        "description": "Update subscription billing period (monthly / semiannual / annual).\n\nGTM-002: Simplified flow \u2014 Stripe handles proration automatically.\nNo deferral logic, no manual credit calculations.",
        "operationId": "update_billing_period_api_subscriptions_update_billing_period_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateBillingPeriodRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UpdateBillingPeriodResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Update Billing Period",
        "tags": [
          "subscriptions"
        ]
      }
    },
    "/auth/resend-confirmation": {
      "post": {
        "description": "Resend signup confirmation email with 60s rate limiting.\n\nAC4: Calls Supabase auth.resend({ type: 'signup', email }).\nAC1-AC6: Frontend uses this with countdown timer.",
        "operationId": "resend_confirmation_auth_resend_confirmation_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ResendRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ResendResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "summary": "Resend Confirmation",
        "tags": [
          "auth-email"
        ]
      }
    },
    "/auth/status": {
      "get": {
        "description": "Check if a signup email has been confirmed.\n\nAC8: Returns { confirmed: boolean, user_id?: string }.\nAC7/AC9: Frontend polls this every 5s for auto-redirect.",
        "operationId": "auth_status_auth_status_get",
        "parameters": [
          {
            "description": "Email to check",
            "in": "query",
            "name": "email",
            "required": true,
            "schema": {
              "description": "Email to check",
              "title": "Email",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthStatusResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "summary": "Auth Status",
        "tags": [
          "auth-email"
        ]
      }
    },
    "/billing-portal": {
      "post": {
        "description": "Create Stripe Billing Portal session (GTM-FIX-007 AC6-AC7).\n\nAllows users to update payment methods, view invoices, and manage subscriptions.\n\nReturns:\n    dict: {\"url\": \"https://billing.stripe.com/...\"}",
        "operationId": "create_billing_portal_session_billing_portal_post",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Create Billing Portal Session",
        "tags": [
          "billing"
        ]
      }
    },
    "/buscar": {
      "post": {
        "description": "Main search endpoint \u2014 thin wrapper that delegates to SearchPipeline.\n\nSTORY-216 AC5: buscar_licitacoes() is a thin wrapper that creates\nSearchPipeline and runs stages. All business logic lives in search_pipeline.py.\n\nThe wrapper handles:\n- SSE tracker lifecycle (create, cleanup on error)\n- Exception mapping (PNCPRateLimitError \u2192 503, PNCPAPIError \u2192 502, etc.)\n- Dependency injection (passing module-level names for test mock compatibility)",
        "operationId": "buscar_licitacoes_buscar_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BuscaRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BuscaResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Buscar Licitacoes",
        "tags": [
          "search"
        ]
      }
    },
    "/buscar-progress/{search_id}": {
      "get": {
        "description": "SSE endpoint for real-time search progress updates.\n\nThe client opens this connection simultaneously with POST /buscar,\nusing the same search_id to correlate progress events.\n\nEvents:\n    - connecting (5%): Initial setup\n    - fetching (10-55%): Per-UF progress with uf_index/uf_total\n    - filtering (60-70%): Filter application\n    - llm (75-90%): LLM summary generation\n    - excel (92-98%): Excel report generation\n    - complete (100%): Search finished\n    - error: Search failed",
        "operationId": "buscar_progress_stream_buscar_progress__search_id__get",
        "parameters": [
          {
            "in": "path",
            "name": "search_id",
            "required": true,
            "schema": {
              "title": "Search Id",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Buscar Progress Stream",
        "tags": [
          "search"
        ]
      }
    },
    "/change-password": {
      "post": {
        "description": "Change current user's password.",
        "operationId": "change_password_change_password_post",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Change Password",
        "tags": [
          "user"
        ]
      }
    },
    "/checkout": {
      "post": {
        "description": "Create Stripe Checkout session for a plan purchase.",
        "operationId": "create_checkout_checkout_post",
        "parameters": [
          {
            "in": "query",
            "name": "plan_id",
            "required": true,
            "schema": {
              "title": "Plan Id",
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "billing_period",
            "required": false,
            "schema": {
              "default": "monthly",
              "title": "Billing Period",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CheckoutResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Create Checkout",
        "tags": [
          "billing"
        ]
      }
    },
    "/debug/pncp-test": {
      "get": {
        "description": "Diagnostic: test if PNCP API is reachable from this server. Admin only.",
        "operationId": "debug_pncp_test_debug_pncp_test_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DebugPNCPResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Debug Pncp Test"
      }
    },
    "/emails/send-welcome": {
      "post": {
        "description": "Send welcome email to authenticated user (idempotent).\n\nAC7: Triggered after successful signup (both email and Google OAuth).\nFrontend calls this after signup confirmation.\nIdempotent: checks profiles.welcome_email_sent_at before sending.",
        "operationId": "send_welcome_email_emails_send_welcome_post",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WelcomeEmailResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Send Welcome Email",
        "tags": [
          "emails"
        ]
      }
    },
    "/emails/unsubscribe": {
      "get": {
        "description": "Unsubscribe from marketing emails.\n\nAC15: Unsubscribe mechanism in all marketing emails (LGPD + CAN-SPAM).\nAC16: Updates user preference in database.\nAC17: Transactional emails exempt (payment, security).",
        "operationId": "unsubscribe_email_emails_unsubscribe_get",
        "parameters": [
          {
            "description": "User ID",
            "in": "query",
            "name": "user_id",
            "required": true,
            "schema": {
              "description": "User ID",
              "title": "User Id",
              "type": "string"
            }
          },
          {
            "description": "Verification token",
            "in": "query",
            "name": "token",
            "required": true,
            "schema": {
              "description": "Verification token",
              "title": "Token",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "text/html": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "summary": "Unsubscribe Email",
        "tags": [
          "emails"
        ]
      }
    },
    "/first-analysis": {
      "post": {
        "description": "Execute first automatic analysis based on onboarding profile.\n\nGTM-004 AC1-4: Maps CNAE to sector, builds BuscaRequest automatically,\nexecutes search in background, and returns search_id for SSE tracking.",
        "operationId": "first_analysis_first_analysis_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/FirstAnalysisRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FirstAnalysisResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "First Analysis",
        "tags": [
          "onboarding"
        ]
      }
    },
    "/health": {
      "get": {
        "description": "Health check endpoint for monitoring and load balancers.\n\nProvides lightweight service health verification including dependency\nchecks for Supabase, OpenAI, and Redis connectivity.",
        "operationId": "health_health_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "summary": "Health"
      }
    },
    "/me": {
      "delete": {
        "description": "Delete entire user account and all associated data (LGPD Art. 18 VI).\n\nCascade order:\n1. Cancel active Stripe subscription (if any)\n2. Delete from: search_sessions, monthly_quota, user_subscriptions,\n   user_oauth_tokens, messages, profiles\n3. Delete auth user via Supabase admin API\n4. Log anonymized audit entry",
        "operationId": "delete_account_me_delete",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DeleteAccountResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Delete Account",
        "tags": [
          "user"
        ]
      },
      "get": {
        "description": "Get current user profile with plan capabilities and quota status.",
        "operationId": "get_profile_me_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserProfileResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Profile",
        "tags": [
          "user"
        ]
      }
    },
    "/me/export": {
      "get": {
        "description": "Export all user data as JSON file (LGPD Art. 18 V \u2014 data portability).\n\nReturns a downloadable JSON file containing:\n- Profile information\n- Search history (sessions)\n- Subscription history\n- Messages",
        "operationId": "export_user_data_me_export_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Export User Data",
        "tags": [
          "user"
        ]
      }
    },
    "/pipeline": {
      "get": {
        "description": "List pipeline items for the authenticated user (AC3).\n\nSupports filtering by stage and pagination via limit/offset.",
        "operationId": "list_pipeline_items_pipeline_get",
        "parameters": [
          {
            "description": "Filter by stage",
            "in": "query",
            "name": "stage",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by stage",
              "title": "Stage"
            }
          },
          {
            "description": "Items per page",
            "in": "query",
            "name": "limit",
            "required": false,
            "schema": {
              "default": 50,
              "description": "Items per page",
              "maximum": 200,
              "minimum": 1,
              "title": "Limit",
              "type": "integer"
            }
          },
          {
            "description": "Offset for pagination",
            "in": "query",
            "name": "offset",
            "required": false,
            "schema": {
              "default": 0,
              "description": "Offset for pagination",
              "minimum": 0,
              "title": "Offset",
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PipelineListResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "List Pipeline Items",
        "tags": [
          "pipeline"
        ]
      },
      "post": {
        "description": "Add a procurement opportunity to the user's pipeline (AC2).\n\nReturns 409 if the item already exists (UNIQUE constraint on user_id + pncp_id).",
        "operationId": "create_pipeline_item_pipeline_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PipelineItemCreate"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Create Pipeline Item",
        "tags": [
          "pipeline"
        ]
      }
    },
    "/pipeline/alerts": {
      "get": {
        "description": "Get pipeline items with deadlines within 3 days (AC6).\n\nReturns items where data_encerramento < now() + 3 days\nand stage is NOT in ('enviada', 'resultado').",
        "operationId": "get_pipeline_alerts_pipeline_alerts_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PipelineAlertsResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Pipeline Alerts",
        "tags": [
          "pipeline"
        ]
      }
    },
    "/pipeline/{item_id}": {
      "delete": {
        "description": "Remove an item from the pipeline (AC5).\n\nReturns 404 if item doesn't exist or doesn't belong to user.",
        "operationId": "delete_pipeline_item_pipeline__item_id__delete",
        "parameters": [
          {
            "in": "path",
            "name": "item_id",
            "required": true,
            "schema": {
              "title": "Item Id",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Delete Pipeline Item",
        "tags": [
          "pipeline"
        ]
      },
      "patch": {
        "description": "Update stage and/or notes of a pipeline item (AC4).\n\nValidates that stage is a valid enum value.\nReturns 404 if item doesn't exist or doesn't belong to user.",
        "operationId": "update_pipeline_item_pipeline__item_id__patch",
        "parameters": [
          {
            "in": "path",
            "name": "item_id",
            "required": true,
            "schema": {
              "title": "Item Id",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PipelineItemUpdate"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Update Pipeline Item",
        "tags": [
          "pipeline"
        ]
      }
    },
    "/plans": {
      "get": {
        "description": "Get available subscription plans.",
        "operationId": "get_plans_plans_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BillingPlansResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "summary": "Get Plans",
        "tags": [
          "billing"
        ]
      }
    },
    "/profile/context": {
      "get": {
        "description": "Get business context from profile (STORY-247 AC3).",
        "operationId": "get_profile_context_profile_context_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PerfilContextoResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Profile Context",
        "tags": [
          "user"
        ]
      },
      "put": {
        "description": "Save business context from onboarding wizard (STORY-247 AC2).\n\nStores context_data as JSONB in profiles table.",
        "operationId": "save_profile_context_profile_context_put",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PerfilContexto"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PerfilContextoResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Save Profile Context",
        "tags": [
          "user"
        ]
      }
    },
    "/sessions": {
      "get": {
        "description": "Get user's search session history.",
        "operationId": "get_sessions_sessions_get",
        "parameters": [
          {
            "in": "query",
            "name": "limit",
            "required": false,
            "schema": {
              "default": 20,
              "maximum": 100,
              "minimum": 1,
              "title": "Limit",
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "offset",
            "required": false,
            "schema": {
              "default": 0,
              "minimum": 0,
              "title": "Offset",
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SessionsListResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Sessions",
        "tags": [
          "sessions"
        ]
      }
    },
    "/setores": {
      "get": {
        "description": "Return available procurement sectors for frontend dropdown.\n\nSTORY-252 Track 5 (AC24): Mounted at both /setores (legacy) and /v1/setores (versioned).",
        "operationId": "listar_setores_setores_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SetoresResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "summary": "Listar Setores"
      }
    },
    "/sources/health": {
      "get": {
        "description": "Health check for all configured procurement data sources.\n\nReturns status, response time, and priority for each source.",
        "operationId": "sources_health_sources_health_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SourcesHealthResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "summary": "Sources Health"
      }
    },
    "/subscription/status": {
      "get": {
        "description": "Check subscription activation status (GTM-FIX-016).\n\nUsed by obrigado page to poll for webhook completion.\nReturns current subscription state from DB, with Stripe API fallback.",
        "operationId": "get_subscription_status_subscription_status_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Subscription Status",
        "tags": [
          "billing"
        ]
      }
    },
    "/trial-status": {
      "get": {
        "description": "Get detailed trial status for conversion flow (GTM-010 AC3).\n\nReturns days remaining, usage stats, and expiration info.",
        "operationId": "get_trial_status_trial_status_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TrialStatusResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Trial Status",
        "tags": [
          "user"
        ]
      }
    },
    "/v1/admin/admin/filter-stats": {
      "get": {
        "description": "STORY-248 AC10: Filter rejection statistics.\n\nReturns counts of each rejection reason code for the specified period.\nAdmin-only endpoint.\n\nReason codes:\n- keyword_miss: No sector keyword found in procurement description\n- exclusion_hit: Exclusion keyword matched (false-positive prevention)\n- llm_reject: LLM arbiter rejected the contract\n- density_low: Term density below minimum threshold\n- value_exceed: Contract value exceeds sector maximum\n- uf_mismatch: State (UF) not in selected set\n- status_mismatch: Procurement status does not match filter",
        "operationId": "get_filter_stats_v1_admin_admin_filter_stats_get",
        "parameters": [
          {
            "description": "Number of days to look back",
            "in": "query",
            "name": "days",
            "required": false,
            "schema": {
              "default": 7,
              "description": "Number of days to look back",
              "maximum": 90,
              "minimum": 1,
              "title": "Days",
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Filter Stats",
        "tags": [
          "admin"
        ]
      }
    },
    "/v1/admin/feature-flags/reload": {
      "post": {
        "description": "Reload all feature flags from environment variables (admin only).\n\nSTORY-226 AC16: Clears the feature flag cache, forcing re-read from\nenvironment on next access. Returns current values after reload.",
        "operationId": "reload_feature_flags_endpoint_v1_admin_feature_flags_reload_post",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Reload Feature Flags Endpoint",
        "tags": [
          "admin"
        ]
      }
    },
    "/v1/admin/users": {
      "get": {
        "description": "List all users with profiles and subscription info.",
        "operationId": "list_users_v1_admin_users_get",
        "parameters": [
          {
            "in": "query",
            "name": "limit",
            "required": false,
            "schema": {
              "default": 50,
              "maximum": 200,
              "minimum": 1,
              "title": "Limit",
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "offset",
            "required": false,
            "schema": {
              "default": 0,
              "minimum": 0,
              "title": "Offset",
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "search",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "maxLength": 100,
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "title": "Search"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminUsersListResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "List Users",
        "tags": [
          "admin"
        ]
      },
      "post": {
        "description": "Create a new user with optional plan assignment.",
        "operationId": "create_user_v1_admin_users_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateUserRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminCreateUserResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Create User",
        "tags": [
          "admin"
        ]
      }
    },
    "/v1/admin/users/{user_id}": {
      "delete": {
        "description": "Delete a user and all their data.",
        "operationId": "delete_user_v1_admin_users__user_id__delete",
        "parameters": [
          {
            "description": "User UUID to delete",
            "in": "path",
            "name": "user_id",
            "required": true,
            "schema": {
              "description": "User UUID to delete",
              "title": "User Id",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminDeleteUserResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Delete User",
        "tags": [
          "admin"
        ]
      },
      "put": {
        "description": "Update user profile or plan.",
        "operationId": "update_user_v1_admin_users__user_id__put",
        "parameters": [
          {
            "description": "User UUID to update",
            "in": "path",
            "name": "user_id",
            "required": true,
            "schema": {
              "description": "User UUID to update",
              "title": "User Id",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateUserRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminUpdateUserResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Update User",
        "tags": [
          "admin"
        ]
      }
    },
    "/v1/admin/users/{user_id}/assign-plan": {
      "post": {
        "description": "Manually assign a plan to a user (bypasses payment).",
        "operationId": "assign_plan_v1_admin_users__user_id__assign_plan_post",
        "parameters": [
          {
            "description": "User UUID to assign plan to",
            "in": "path",
            "name": "user_id",
            "required": true,
            "schema": {
              "description": "User UUID to assign plan to",
              "title": "User Id",
              "type": "string"
            }
          },
          {
            "description": "Plan ID to assign",
            "in": "query",
            "name": "plan_id",
            "required": true,
            "schema": {
              "description": "Plan ID to assign",
              "title": "Plan Id",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminAssignPlanResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Assign Plan",
        "tags": [
          "admin"
        ]
      }
    },
    "/v1/admin/users/{user_id}/credits": {
      "put": {
        "description": "Manually adjust a user's credits (admin only).\n\nSets the credits_remaining value directly on the user's active subscription.\nIf no active subscription exists, creates one based on user's current plan.\n\nArgs:\n    user_id: UUID of the user\n    req.credits: New credit value (must be >= 0)\n\nReturns:\n    Updated user info with new credit value",
        "operationId": "update_user_credits_v1_admin_users__user_id__credits_put",
        "parameters": [
          {
            "description": "User UUID to update credits for",
            "in": "path",
            "name": "user_id",
            "required": true,
            "schema": {
              "description": "User UUID to update credits for",
              "title": "User Id",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateCreditsRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminUpdateCreditsResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Update User Credits",
        "tags": [
          "admin"
        ]
      }
    },
    "/v1/admin/users/{user_id}/reset-password": {
      "post": {
        "description": "Reset a user's password (admin only).",
        "operationId": "reset_user_password_v1_admin_users__user_id__reset_password_post",
        "parameters": [
          {
            "description": "User UUID to reset password for",
            "in": "path",
            "name": "user_id",
            "required": true,
            "schema": {
              "description": "User UUID to reset password for",
              "title": "User Id",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminResetPasswordResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Reset User Password",
        "tags": [
          "admin"
        ]
      }
    },
    "/v1/analytics/searches-over-time": {
      "get": {
        "description": "Get time-series search data grouped by period.",
        "operationId": "get_searches_over_time_v1_analytics_searches_over_time_get",
        "parameters": [
          {
            "in": "query",
            "name": "period",
            "required": false,
            "schema": {
              "default": "week",
              "pattern": "^(day|week|month)$",
              "title": "Period",
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "range_days",
            "required": false,
            "schema": {
              "default": 90,
              "maximum": 365,
              "minimum": 1,
              "title": "Range Days",
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchesOverTimeResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Searches Over Time",
        "tags": [
          "analytics"
        ]
      }
    },
    "/v1/analytics/summary": {
      "get": {
        "description": "Get overall user analytics summary.",
        "operationId": "get_analytics_summary_v1_analytics_summary_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SummaryResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Analytics Summary",
        "tags": [
          "analytics"
        ]
      }
    },
    "/v1/analytics/top-dimensions": {
      "get": {
        "description": "Get top UFs and sectors by search count.",
        "operationId": "get_top_dimensions_v1_analytics_top_dimensions_get",
        "parameters": [
          {
            "in": "query",
            "name": "limit",
            "required": false,
            "schema": {
              "default": 5,
              "maximum": 50,
              "minimum": 1,
              "title": "Limit",
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TopDimensionsResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Top Dimensions",
        "tags": [
          "analytics"
        ]
      }
    },
    "/v1/analytics/trial-value": {
      "get": {
        "description": "Get value generated during trial period (GTM-010 AC1).\n\nReturns aggregated statistics of opportunities analyzed during the user's trial.\nUsed by TrialConversionScreen to show personalized conversion messaging.",
        "operationId": "get_trial_value_v1_analytics_trial_value_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TrialValueResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Trial Value",
        "tags": [
          "analytics"
        ]
      }
    },
    "/v1/api/auth/google": {
      "delete": {
        "description": "Revoke Google OAuth access and delete tokens.\n\nDeletes user's OAuth tokens from database and revokes access with Google.\n\nReturns:\n    {\n        \"success\": true,\n        \"message\": \"Google Sheets access revoked successfully\"\n    }\n\nSecurity:\n    - Requires authentication\n    - Only deletes tokens for authenticated user\n    - Revokes with Google API (best effort)\n\nNote:\n    Revoking access does NOT delete existing spreadsheets.\n    Spreadsheets remain in user's Google Drive.",
        "operationId": "google_oauth_revoke_v1_api_auth_google_delete",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RevokeResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Google Oauth Revoke",
        "tags": [
          "oauth"
        ]
      },
      "get": {
        "description": "Initiate Google OAuth 2.0 flow.\n\nRedirects user to Google consent screen to authorize Google Sheets access.\n\nQuery Parameters:\n    redirect: Frontend path to return to after authorization\n\nReturns:\n    302 Redirect to Google OAuth consent screen\n\nSecurity:\n    - CSRF protection via state parameter\n    - State encodes user_id + redirect path\n    - Validates state on callback\n\nExample:\n    GET /api/auth/google?redirect=/buscar\n    \u2192 Redirects to https://accounts.google.com/o/oauth2/auth?...",
        "operationId": "google_oauth_initiate_v1_api_auth_google_get",
        "parameters": [
          {
            "description": "Page to return to after auth",
            "in": "query",
            "name": "redirect",
            "required": false,
            "schema": {
              "default": "/buscar",
              "description": "Page to return to after auth",
              "title": "Redirect",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Google Oauth Initiate",
        "tags": [
          "oauth"
        ]
      }
    },
    "/v1/api/auth/google/callback": {
      "get": {
        "description": "Handle OAuth callback from Google.\n\nThis endpoint is called by Google after user authorizes access.\n\nQuery Parameters:\n    code: Authorization code (exchanged for tokens), absent on error\n    state: CSRF state token (contains user_id + redirect path)\n    error: OAuth error code (if authorization failed)\n\nReturns:\n    302 Redirect to frontend with success/error status\n\nFlow:\n    1. Decode state param to get user_id and redirect path\n    2. Exchange code for tokens (access + refresh)\n    3. Encrypt and save tokens to database\n    4. Redirect to frontend with success flag\n\nError Handling:\n    - Invalid state \u2192 Redirect with error=invalid_state\n    - Code exchange failed \u2192 Redirect with error=oauth_failed\n    - Database error \u2192 Redirect with error=storage_failed",
        "operationId": "google_oauth_callback_v1_api_auth_google_callback_get",
        "parameters": [
          {
            "description": "Authorization code from Google",
            "in": "query",
            "name": "code",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Authorization code from Google",
              "title": "Code"
            }
          },
          {
            "description": "CSRF state token",
            "in": "query",
            "name": "state",
            "required": true,
            "schema": {
              "description": "CSRF state token",
              "title": "State",
              "type": "string"
            }
          },
          {
            "description": "OAuth error (if any)",
            "in": "query",
            "name": "error",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "OAuth error (if any)",
              "title": "Error"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "summary": "Google Oauth Callback",
        "tags": [
          "oauth"
        ]
      }
    },
    "/v1/api/export/google-sheets": {
      "post": {
        "description": "Export search results to Google Sheets.\n\nCreates a new Google Sheets spreadsheet or updates an existing one\nwith search results. Applies professional formatting (green header,\ncurrency symbols, hyperlinks).\n\nRequest Body:\n    {\n        \"licitacoes\": [...],\n        \"title\": \"SmartLic - Uniformes - 09/02/2026\",\n        \"mode\": \"create\" | \"update\",\n        \"spreadsheet_id\": \"optional for update mode\"\n    }\n\nReturns:\n    {\n        \"success\": true,\n        \"spreadsheet_id\": \"...\",\n        \"spreadsheet_url\": \"https://docs.google.com/spreadsheets/d/...\",\n        \"total_rows\": 142,\n        \"updated_at\": \"2026-02-09T15:30:00Z\"  // only for update mode\n    }\n\nErrors:\n    401 Unauthorized: User hasn't authorized Google Sheets\n    403 Forbidden: Token revoked or insufficient permissions\n    429 Too Many Requests: Google API quota exceeded\n    500 Internal Server Error: Google API error\n\nExample:\n    POST /api/export/google-sheets\n    {\n        \"licitacoes\": [...],\n        \"title\": \"SmartLic - Uniformes - SP, RJ\",\n        \"mode\": \"create\"\n    }",
        "operationId": "export_to_google_sheets_v1_api_export_google_sheets_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GoogleSheetsExportRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GoogleSheetsExportResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Export To Google Sheets",
        "tags": [
          "export"
        ]
      }
    },
    "/v1/api/export/google-sheets/history": {
      "get": {
        "description": "Get user's Google Sheets export history.\n\nReturns list of all exports with spreadsheet URLs and search parameters.\nUseful for \"re-open last export\" and usage analytics.\n\nQuery Parameters:\n    limit: Maximum number of exports to return (default: 50, max: 100)\n\nReturns:\n    {\n        \"exports\": [\n            {\n                \"id\": \"uuid\",\n                \"spreadsheet_id\": \"...\",\n                \"spreadsheet_url\": \"https://docs.google.com/...\",\n                \"search_params\": {\"ufs\": [\"SP\"], \"setor\": \"Uniformes\"},\n                \"total_rows\": 142,\n                \"created_at\": \"2026-02-09T15:30:00Z\",\n                \"last_updated_at\": \"2026-02-09T15:30:00Z\"\n            }\n        ],\n        \"total\": 1\n    }\n\nExample:\n    GET /api/export/google-sheets/history?limit=20",
        "operationId": "get_export_history_v1_api_export_google_sheets_history_get",
        "parameters": [
          {
            "in": "query",
            "name": "limit",
            "required": false,
            "schema": {
              "default": 50,
              "title": "Limit",
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GoogleSheetsExportHistoryResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Export History",
        "tags": [
          "export"
        ]
      }
    },
    "/v1/api/features/me": {
      "get": {
        "description": "Get current user's enabled features.\n\nCACHING STRATEGY (STORY-217: unified pool):\n- Redis cache with 5-minute TTL via shared pool\n- Cache key: ``features:{user_id}``\n- Cache miss: Fetch from Supabase (JOIN user_subscriptions + plan_features)\n- Graceful degradation via InMemoryCache fallback",
        "operationId": "get_my_features_v1_api_features_me_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserFeaturesResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get My Features",
        "tags": [
          "features"
        ]
      }
    },
    "/v1/api/messages/conversations": {
      "get": {
        "operationId": "list_conversations_v1_api_messages_conversations_get",
        "parameters": [
          {
            "in": "query",
            "name": "status",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "title": "Status"
            }
          },
          {
            "in": "query",
            "name": "limit",
            "required": false,
            "schema": {
              "default": 50,
              "maximum": 100,
              "minimum": 1,
              "title": "Limit",
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "offset",
            "required": false,
            "schema": {
              "default": 0,
              "minimum": 0,
              "title": "Offset",
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ConversationsListResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "List Conversations",
        "tags": [
          "messages"
        ]
      },
      "post": {
        "operationId": "create_conversation_v1_api_messages_conversations_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateConversationRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreateConversationResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Create Conversation",
        "tags": [
          "messages"
        ]
      }
    },
    "/v1/api/messages/conversations/{conversation_id}": {
      "get": {
        "operationId": "get_conversation_v1_api_messages_conversations__conversation_id__get",
        "parameters": [
          {
            "in": "path",
            "name": "conversation_id",
            "required": true,
            "schema": {
              "title": "Conversation Id",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ConversationDetail"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Conversation",
        "tags": [
          "messages"
        ]
      }
    },
    "/v1/api/messages/conversations/{conversation_id}/reply": {
      "post": {
        "operationId": "reply_to_conversation_v1_api_messages_conversations__conversation_id__reply_post",
        "parameters": [
          {
            "in": "path",
            "name": "conversation_id",
            "required": true,
            "schema": {
              "title": "Conversation Id",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ReplyRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReplyStatusResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Reply To Conversation",
        "tags": [
          "messages"
        ]
      }
    },
    "/v1/api/messages/conversations/{conversation_id}/status": {
      "patch": {
        "operationId": "update_conversation_status_v1_api_messages_conversations__conversation_id__status_patch",
        "parameters": [
          {
            "in": "path",
            "name": "conversation_id",
            "required": true,
            "schema": {
              "title": "Conversation Id",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateConversationStatusRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StatusResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Update Conversation Status",
        "tags": [
          "messages"
        ]
      }
    },
    "/v1/api/messages/unread-count": {
      "get": {
        "operationId": "get_unread_count_v1_api_messages_unread_count_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UnreadCountResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Unread Count",
        "tags": [
          "messages"
        ]
      }
    },
    "/v1/api/plans": {
      "get": {
        "description": "Get all active plans with capabilities and pricing.\n\nSTORY-203 CROSS-M01: Combines plan metadata from database with\ncapabilities from SYS-M04 infrastructure. This provides a single\nendpoint for frontend to fetch all plan-related data.\n\nReturns:\n    PlansResponse: List of plans with full details\n\nRaises:\n    HTTPException 500: If database query fails",
        "operationId": "get_plans_with_capabilities_v1_api_plans_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PlansResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "summary": "Get Plans With Capabilities",
        "tags": [
          "plans"
        ]
      }
    },
    "/v1/api/subscriptions/cancel": {
      "post": {
        "description": "Cancel subscription at period end.\n\nGTM-FIX-006: User-initiated cancellation flow.\nSets cancel_at_period_end=True in Stripe, updates status to 'canceling'.",
        "operationId": "cancel_subscription_v1_api_subscriptions_cancel_post",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CancelSubscriptionResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Cancel Subscription",
        "tags": [
          "subscriptions"
        ]
      }
    },
    "/v1/api/subscriptions/update-billing-period": {
      "post": {
        "description": "Update subscription billing period (monthly / semiannual / annual).\n\nGTM-002: Simplified flow \u2014 Stripe handles proration automatically.\nNo deferral logic, no manual credit calculations.",
        "operationId": "update_billing_period_v1_api_subscriptions_update_billing_period_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateBillingPeriodRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UpdateBillingPeriodResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Update Billing Period",
        "tags": [
          "subscriptions"
        ]
      }
    },
    "/v1/auth/resend-confirmation": {
      "post": {
        "description": "Resend signup confirmation email with 60s rate limiting.\n\nAC4: Calls Supabase auth.resend({ type: 'signup', email }).\nAC1-AC6: Frontend uses this with countdown timer.",
        "operationId": "resend_confirmation_v1_auth_resend_confirmation_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ResendRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ResendResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "summary": "Resend Confirmation",
        "tags": [
          "auth-email"
        ]
      }
    },
    "/v1/auth/status": {
      "get": {
        "description": "Check if a signup email has been confirmed.\n\nAC8: Returns { confirmed: boolean, user_id?: string }.\nAC7/AC9: Frontend polls this every 5s for auto-redirect.",
        "operationId": "auth_status_v1_auth_status_get",
        "parameters": [
          {
            "description": "Email to check",
            "in": "query",
            "name": "email",
            "required": true,
            "schema": {
              "description": "Email to check",
              "title": "Email",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthStatusResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "summary": "Auth Status",
        "tags": [
          "auth-email"
        ]
      }
    },
    "/v1/billing-portal": {
      "post": {
        "description": "Create Stripe Billing Portal session (GTM-FIX-007 AC6-AC7).\n\nAllows users to update payment methods, view invoices, and manage subscriptions.\n\nReturns:\n    dict: {\"url\": \"https://billing.stripe.com/...\"}",
        "operationId": "create_billing_portal_session_v1_billing_portal_post",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Create Billing Portal Session",
        "tags": [
          "billing"
        ]
      }
    },
    "/v1/buscar": {
      "post": {
        "description": "Main search endpoint \u2014 thin wrapper that delegates to SearchPipeline.\n\nSTORY-216 AC5: buscar_licitacoes() is a thin wrapper that creates\nSearchPipeline and runs stages. All business logic lives in search_pipeline.py.\n\nThe wrapper handles:\n- SSE tracker lifecycle (create, cleanup on error)\n- Exception mapping (PNCPRateLimitError \u2192 503, PNCPAPIError \u2192 502, etc.)\n- Dependency injection (passing module-level names for test mock compatibility)",
        "operationId": "buscar_licitacoes_v1_buscar_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BuscaRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BuscaResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Buscar Licitacoes",
        "tags": [
          "search"
        ]
      }
    },
    "/v1/buscar-progress/{search_id}": {
      "get": {
        "description": "SSE endpoint for real-time search progress updates.\n\nThe client opens this connection simultaneously with POST /buscar,\nusing the same search_id to correlate progress events.\n\nEvents:\n    - connecting (5%): Initial setup\n    - fetching (10-55%): Per-UF progress with uf_index/uf_total\n    - filtering (60-70%): Filter application\n    - llm (75-90%): LLM summary generation\n    - excel (92-98%): Excel report generation\n    - complete (100%): Search finished\n    - error: Search failed",
        "operationId": "buscar_progress_stream_v1_buscar_progress__search_id__get",
        "parameters": [
          {
            "in": "path",
            "name": "search_id",
            "required": true,
            "schema": {
              "title": "Search Id",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Buscar Progress Stream",
        "tags": [
          "search"
        ]
      }
    },
    "/v1/change-password": {
      "post": {
        "description": "Change current user's password.",
        "operationId": "change_password_v1_change_password_post",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Change Password",
        "tags": [
          "user"
        ]
      }
    },
    "/v1/checkout": {
      "post": {
        "description": "Create Stripe Checkout session for a plan purchase.",
        "operationId": "create_checkout_v1_checkout_post",
        "parameters": [
          {
            "in": "query",
            "name": "plan_id",
            "required": true,
            "schema": {
              "title": "Plan Id",
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "billing_period",
            "required": false,
            "schema": {
              "default": "monthly",
              "title": "Billing Period",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CheckoutResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Create Checkout",
        "tags": [
          "billing"
        ]
      }
    },
    "/v1/emails/send-welcome": {
      "post": {
        "description": "Send welcome email to authenticated user (idempotent).\n\nAC7: Triggered after successful signup (both email and Google OAuth).\nFrontend calls this after signup confirmation.\nIdempotent: checks profiles.welcome_email_sent_at before sending.",
        "operationId": "send_welcome_email_v1_emails_send_welcome_post",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WelcomeEmailResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Send Welcome Email",
        "tags": [
          "emails"
        ]
      }
    },
    "/v1/emails/unsubscribe": {
      "get": {
        "description": "Unsubscribe from marketing emails.\n\nAC15: Unsubscribe mechanism in all marketing emails (LGPD + CAN-SPAM).\nAC16: Updates user preference in database.\nAC17: Transactional emails exempt (payment, security).",
        "operationId": "unsubscribe_email_v1_emails_unsubscribe_get",
        "parameters": [
          {
            "description": "User ID",
            "in": "query",
            "name": "user_id",
            "required": true,
            "schema": {
              "description": "User ID",
              "title": "User Id",
              "type": "string"
            }
          },
          {
            "description": "Verification token",
            "in": "query",
            "name": "token",
            "required": true,
            "schema": {
              "description": "Verification token",
              "title": "Token",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "text/html": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "summary": "Unsubscribe Email",
        "tags": [
          "emails"
        ]
      }
    },
    "/v1/first-analysis": {
      "post": {
        "description": "Execute first automatic analysis based on onboarding profile.\n\nGTM-004 AC1-4: Maps CNAE to sector, builds BuscaRequest automatically,\nexecutes search in background, and returns search_id for SSE tracking.",
        "operationId": "first_analysis_v1_first_analysis_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/FirstAnalysisRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FirstAnalysisResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "First Analysis",
        "tags": [
          "onboarding"
        ]
      }
    },
    "/v1/me": {
      "delete": {
        "description": "Delete entire user account and all associated data (LGPD Art. 18 VI).\n\nCascade order:\n1. Cancel active Stripe subscription (if any)\n2. Delete from: search_sessions, monthly_quota, user_subscriptions,\n   user_oauth_tokens, messages, profiles\n3. Delete auth user via Supabase admin API\n4. Log anonymized audit entry",
        "operationId": "delete_account_v1_me_delete",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DeleteAccountResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Delete Account",
        "tags": [
          "user"
        ]
      },
      "get": {
        "description": "Get current user profile with plan capabilities and quota status.",
        "operationId": "get_profile_v1_me_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserProfileResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Profile",
        "tags": [
          "user"
        ]
      }
    },
    "/v1/me/export": {
      "get": {
        "description": "Export all user data as JSON file (LGPD Art. 18 V \u2014 data portability).\n\nReturns a downloadable JSON file containing:\n- Profile information\n- Search history (sessions)\n- Subscription history\n- Messages",
        "operationId": "export_user_data_v1_me_export_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Export User Data",
        "tags": [
          "user"
        ]
      }
    },
    "/v1/pipeline": {
      "get": {
        "description": "List pipeline items for the authenticated user (AC3).\n\nSupports filtering by stage and pagination via limit/offset.",
        "operationId": "list_pipeline_items_v1_pipeline_get",
        "parameters": [
          {
            "description": "Filter by stage",
            "in": "query",
            "name": "stage",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by stage",
              "title": "Stage"
            }
          },
          {
            "description": "Items per page",
            "in": "query",
            "name": "limit",
            "required": false,
            "schema": {
              "default": 50,
              "description": "Items per page",
              "maximum": 200,
              "minimum": 1,
              "title": "Limit",
              "type": "integer"
            }
          },
          {
            "description": "Offset for pagination",
            "in": "query",
            "name": "offset",
            "required": false,
            "schema": {
              "default": 0,
              "description": "Offset for pagination",
              "minimum": 0,
              "title": "Offset",
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PipelineListResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "List Pipeline Items",
        "tags": [
          "pipeline"
        ]
      },
      "post": {
        "description": "Add a procurement opportunity to the user's pipeline (AC2).\n\nReturns 409 if the item already exists (UNIQUE constraint on user_id + pncp_id).",
        "operationId": "create_pipeline_item_v1_pipeline_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PipelineItemCreate"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Create Pipeline Item",
        "tags": [
          "pipeline"
        ]
      }
    },
    "/v1/pipeline/alerts": {
      "get": {
        "description": "Get pipeline items with deadlines within 3 days (AC6).\n\nReturns items where data_encerramento < now() + 3 days\nand stage is NOT in ('enviada', 'resultado').",
        "operationId": "get_pipeline_alerts_v1_pipeline_alerts_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PipelineAlertsResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Pipeline Alerts",
        "tags": [
          "pipeline"
        ]
      }
    },
    "/v1/pipeline/{item_id}": {
      "delete": {
        "description": "Remove an item from the pipeline (AC5).\n\nReturns 404 if item doesn't exist or doesn't belong to user.",
        "operationId": "delete_pipeline_item_v1_pipeline__item_id__delete",
        "parameters": [
          {
            "in": "path",
            "name": "item_id",
            "required": true,
            "schema": {
              "title": "Item Id",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Delete Pipeline Item",
        "tags": [
          "pipeline"
        ]
      },
      "patch": {
        "description": "Update stage and/or notes of a pipeline item (AC4).\n\nValidates that stage is a valid enum value.\nReturns 404 if item doesn't exist or doesn't belong to user.",
        "operationId": "update_pipeline_item_v1_pipeline__item_id__patch",
        "parameters": [
          {
            "in": "path",
            "name": "item_id",
            "required": true,
            "schema": {
              "title": "Item Id",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PipelineItemUpdate"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Update Pipeline Item",
        "tags": [
          "pipeline"
        ]
      }
    },
    "/v1/plans": {
      "get": {
        "description": "Get available subscription plans.",
        "operationId": "get_plans_v1_plans_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BillingPlansResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "summary": "Get Plans",
        "tags": [
          "billing"
        ]
      }
    },
    "/v1/profile/context": {
      "get": {
        "description": "Get business context from profile (STORY-247 AC3).",
        "operationId": "get_profile_context_v1_profile_context_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PerfilContextoResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Profile Context",
        "tags": [
          "user"
        ]
      },
      "put": {
        "description": "Save business context from onboarding wizard (STORY-247 AC2).\n\nStores context_data as JSONB in profiles table.",
        "operationId": "save_profile_context_v1_profile_context_put",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PerfilContexto"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PerfilContextoResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Save Profile Context",
        "tags": [
          "user"
        ]
      }
    },
    "/v1/sessions": {
      "get": {
        "description": "Get user's search session history.",
        "operationId": "get_sessions_v1_sessions_get",
        "parameters": [
          {
            "in": "query",
            "name": "limit",
            "required": false,
            "schema": {
              "default": 20,
              "maximum": 100,
              "minimum": 1,
              "title": "Limit",
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "offset",
            "required": false,
            "schema": {
              "default": 0,
              "minimum": 0,
              "title": "Offset",
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SessionsListResponse"
                }
              }
            },
            "description": "Successful Response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            },
            "description": "Validation Error"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Sessions",
        "tags": [
          "sessions"
        ]
      }
    },
    "/v1/setores": {
      "get": {
        "description": "Return available procurement sectors for frontend dropdown.\n\nSTORY-252 Track 5 (AC24): Mounted at both /setores (legacy) and /v1/setores (versioned).",
        "operationId": "listar_setores_v1_setores_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SetoresResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "summary": "Listar Setores"
      }
    },
    "/v1/subscription/status": {
      "get": {
        "description": "Check subscription activation status (GTM-FIX-016).\n\nUsed by obrigado page to poll for webhook completion.\nReturns current subscription state from DB, with Stripe API fallback.",
        "operationId": "get_subscription_status_v1_subscription_status_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Subscription Status",
        "tags": [
          "billing"
        ]
      }
    },
    "/v1/trial-status": {
      "get": {
        "description": "Get detailed trial status for conversion flow (GTM-010 AC3).\n\nReturns days remaining, usage stats, and expiration info.",
        "operationId": "get_trial_status_v1_trial_status_get",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TrialStatusResponse"
                }
              }
            },
            "description": "Successful Response"
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "summary": "Get Trial Status",
        "tags": [
          "user"
        ]
      }
    },
    "/v1/webhooks/stripe": {
      "post": {
        "description": "Handle Stripe webhook events with idempotency and signature validation.\n\nSecurity:\n- Verifies Stripe signature to prevent fake webhooks\n- Rejects unsigned/invalid requests with HTTP 400\n\nIdempotency:\n- Checks stripe_webhook_events table for duplicate event IDs\n- Returns \"already_processed\" for duplicate webhooks\n\nProcessing:\n- Determines billing_period from Stripe subscription interval\n- Updates user_subscriptions table via Supabase client\n- Syncs profiles.plan_type for fallback reliability\n- Invalidates Redis cache for affected user\n- Stores event in stripe_webhook_events for audit trail\n\nArgs:\n    request: FastAPI Request object with Stripe event payload\n\nReturns:\n    dict: {\"status\": \"success\"} or {\"status\": \"already_processed\"}\n\nRaises:\n    HTTPException 400: Invalid payload or signature verification failed\n    HTTPException 500: Database error during processing",
        "operationId": "stripe_webhook_v1_webhooks_stripe_post",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          }
        },
        "summary": "Stripe Webhook"
      }
    },
    "/webhooks/stripe": {
      "post": {
        "description": "Handle Stripe webhook events with idempotency and signature validation.\n\nSecurity:\n- Verifies Stripe signature to prevent fake webhooks\n- Rejects unsigned/invalid requests with HTTP 400\n\nIdempotency:\n- Checks stripe_webhook_events table for duplicate event IDs\n- Returns \"already_processed\" for duplicate webhooks\n\nProcessing:\n- Determines billing_period from Stripe subscription interval\n- Updates user_subscriptions table via Supabase client\n- Syncs profiles.plan_type for fallback reliability\n- Invalidates Redis cache for affected user\n- Stores event in stripe_webhook_events for audit trail\n\nArgs:\n    request: FastAPI Request object with Stripe event payload\n\nReturns:\n    dict: {\"status\": \"success\"} or {\"status\": \"already_processed\"}\n\nRaises:\n    HTTPException 400: Invalid payload or signature verification failed\n    HTTPException 500: Database error during processing",
        "operationId": "stripe_webhook_webhooks_stripe_post",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful Response"
          }
        },
        "summary": "Stripe Webhook"
      }
    }
  }
}