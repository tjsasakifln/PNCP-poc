name: Deploy to Production

on:
  push:
    branches: [master, main]
  workflow_dispatch:

jobs:
  deploy-backend:
    name: Deploy Backend
    runs-on: ubuntu-latest
    if: |
      contains(github.event.head_commit.message, 'backend') ||
      github.event_name == 'workflow_dispatch'

    steps:
      - name: Checkout code
        uses: actions/checkout@v6

      - name: Deploy to Railway (Backend)
        run: |
          echo "⚠️ Deploy backend não configurado ainda (aguardando issue #31)"
          echo "Backend deploy will be configured when Railway setup is complete"
        # Uncomment when issue #31 is implemented:
        # env:
        #   RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
        # run: |
        #   npm i -g @railway/cli
        #   railway up --service backend

      - name: Health check
        run: |
          echo "Health check will be implemented with issue #29"
        # Uncomment when backend is deployed:
        # run: |
        #   sleep 30
        #   curl -f https://your-backend.railway.app/health || exit 1

  deploy-frontend:
    name: Deploy Frontend
    runs-on: ubuntu-latest
    if: |
      contains(github.event.head_commit.message, 'frontend') ||
      github.event_name == 'workflow_dispatch'

    steps:
      - name: Checkout code
        uses: actions/checkout@v6

      - name: Deploy to Vercel (Frontend)
        run: |
          echo "⚠️ Deploy frontend não configurado ainda (aguardando issue #31)"
          echo "Frontend deploy will be configured when Vercel setup is complete"
        # Uncomment when issue #31 is implemented:
        # env:
        #   VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
        #   VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
        #   VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}
        # run: |
        #   cd frontend
        #   npm i -g vercel
        #   vercel --prod --token=$VERCEL_TOKEN

  smoke-tests:
    name: Production Smoke Tests
    runs-on: ubuntu-latest
    needs: [deploy-backend, deploy-frontend]
    if: |
      always() &&
      (needs.deploy-backend.result == 'success' || needs.deploy-backend.result == 'skipped') &&
      (needs.deploy-frontend.result == 'success' || needs.deploy-frontend.result == 'skipped')

    steps:
      - name: Smoke tests placeholder
        run: |
          echo "⚠️ Smoke tests serão implementados em issue #27"
          echo "Production smoke tests will verify:"
          echo "  - Frontend loads correctly"
          echo "  - Backend API is responsive"
          echo "  - Critical user flows work"
