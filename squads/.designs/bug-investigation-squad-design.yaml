# Squad Design Blueprint
# Generated by *design-squad
# Source: Verbal description - Export 404, Search persistence, Billing debit, Search quality bugs
# Created: 2026-02-10T00:00:00Z

squad:
  name: bug-investigation-squad
  description: Squad for investigating and fixing persistent bugs in export, persistence, billing, and search quality
  domain: bug-investigation

analysis:
  entities:
    - GoogleSheets
    - Export
    - Search
    - Billing
    - Results
    - LLM
    - User
    - Header
  workflows:
    - export-to-sheets
    - save-search
    - debit-credits
    - validate-results
    - analyze-quality
    - diagnose-error
    - trace-persistence
    - debug-billing
  integrations:
    - Google Sheets API
    - LLM
    - Database
    - API Backend
  stakeholders:
    - User (free)
    - User (paid)
    - Developer
    - QA

recommendations:
  agents:
    - id: export-investigator
      role: Investigates and fixes Google Sheets export failures (HTTP 404)
      commands:
        - trace-export-path
        - diagnose-404-root-cause
        - validate-api-credentials
        - fix-export-endpoint
        - test-export-flow
        - verify-export-fix
      confidence: 0.95
      user_added: false
      user_modified: false

    - id: persistence-detective
      role: Investigates search persistence and header display bugs
      commands:
        - trace-save-flow
        - debug-database-writes
        - validate-header-state
        - fix-search-persistence
        - test-saved-searches
        - verify-header-display
      confidence: 0.92
      user_added: false
      user_modified: false

    - id: billing-auditor
      role: Investigates and fixes credit debit inconsistencies
      commands:
        - trace-billing-flow
        - audit-credit-transactions
        - debug-debit-logic
        - fix-billing-sync
        - test-credit-debit
        - verify-balance-accuracy
      confidence: 0.90
      user_added: false
      user_modified: false

    - id: search-quality-analyst
      role: Investigates false positives/negatives in search results with LLM
      commands:
        - analyze-search-algorithm
        - audit-llm-decisions
        - identify-false-positives
        - identify-false-negatives
        - tune-relevance-scoring
        - verify-search-quality
      confidence: 0.88
      user_added: false
      user_modified: false

  tasks:
    # export-investigator tasks
    - name: trace-export-path
      agent: export-investigator
      entrada:
        - user_id
        - export_request_id
        - timestamp
      saida:
        - execution_trace
        - api_calls_log
        - error_stack
      confidence: 0.92

    - name: diagnose-404-root-cause
      agent: export-investigator
      entrada:
        - error_logs
        - api_response
        - request_payload
      saida:
        - root_cause_analysis
        - affected_endpoints
        - fix_recommendations
      confidence: 0.94

    - name: validate-api-credentials
      agent: export-investigator
      entrada:
        - google_sheets_config
        - oauth_tokens
      saida:
        - validation_result
        - token_status
        - expiration_info
      confidence: 0.90

    - name: fix-export-endpoint
      agent: export-investigator
      entrada:
        - root_cause_analysis
        - fix_strategy
      saida:
        - patched_code
        - test_results
        - deployment_ready
      confidence: 0.88

    - name: test-export-flow
      agent: export-investigator
      entrada:
        - test_scenarios
        - sample_data
      saida:
        - test_results
        - success_rate
        - regression_check
      confidence: 0.85

    - name: verify-export-fix
      agent: export-investigator
      entrada:
        - production_logs
        - user_reports
      saida:
        - verification_status
        - metrics
        - rollback_needed
      confidence: 0.87

    # persistence-detective tasks
    - name: trace-save-flow
      agent: persistence-detective
      entrada:
        - user_id
        - search_params
        - session_id
      saida:
        - persistence_trace
        - database_operations
        - state_changes
      confidence: 0.91

    - name: debug-database-writes
      agent: persistence-detective
      entrada:
        - query_logs
        - transaction_history
      saida:
        - write_failures
        - constraint_violations
        - deadlock_analysis
      confidence: 0.93

    - name: validate-header-state
      agent: persistence-detective
      entrada:
        - user_session
        - frontend_state
        - backend_state
      saida:
        - state_comparison
        - sync_issues
        - missing_data
      confidence: 0.89

    - name: fix-search-persistence
      agent: persistence-detective
      entrada:
        - debug_analysis
        - fix_strategy
      saida:
        - patched_code
        - migration_script
        - test_results
      confidence: 0.86

    - name: test-saved-searches
      agent: persistence-detective
      entrada:
        - test_users
        - search_scenarios
      saida:
        - persistence_verification
        - header_visibility
        - data_integrity
      confidence: 0.84

    - name: verify-header-display
      agent: persistence-detective
      entrada:
        - ui_snapshots
        - user_feedback
      saida:
        - display_verification
        - browser_compatibility
        - accessibility_check
      confidence: 0.88

    # billing-auditor tasks
    - name: trace-billing-flow
      agent: billing-auditor
      entrada:
        - user_id
        - search_count
        - current_balance
      saida:
        - billing_trace
        - debit_operations
        - balance_changes
      confidence: 0.90

    - name: audit-credit-transactions
      agent: billing-auditor
      entrada:
        - transaction_logs
        - expected_debits
      saida:
        - discrepancies
        - missing_debits
        - double_charges
      confidence: 0.92

    - name: debug-debit-logic
      agent: billing-auditor
      entrada:
        - code_analysis
        - edge_cases
      saida:
        - logic_bugs
        - race_conditions
        - timing_issues
      confidence: 0.91

    - name: fix-billing-sync
      agent: billing-auditor
      entrada:
        - audit_results
        - fix_strategy
      saida:
        - patched_billing_code
        - reconciliation_script
        - test_results
      confidence: 0.87

    - name: test-credit-debit
      agent: billing-auditor
      entrada:
        - test_scenarios
        - concurrent_users
      saida:
        - debit_accuracy
        - race_condition_check
        - consistency_verification
      confidence: 0.85

    - name: verify-balance-accuracy
      agent: billing-auditor
      entrada:
        - user_balances
        - transaction_history
      saida:
        - accuracy_report
        - correction_needed
        - audit_trail
      confidence: 0.89

    # search-quality-analyst tasks
    - name: analyze-search-algorithm
      agent: search-quality-analyst
      entrada:
        - algorithm_code
        - test_queries
        - expected_results
      saida:
        - algorithm_analysis
        - bottlenecks
        - quality_metrics
      confidence: 0.88

    - name: audit-llm-decisions
      agent: search-quality-analyst
      entrada:
        - llm_prompts
        - decision_logs
        - ground_truth
      saida:
        - decision_accuracy
        - prompt_issues
        - model_drift
      confidence: 0.86

    - name: identify-false-positives
      agent: search-quality-analyst
      entrada:
        - search_results
        - relevance_labels
      saida:
        - false_positive_list
        - patterns
        - root_causes
      confidence: 0.90

    - name: identify-false-negatives
      agent: search-quality-analyst
      entrada:
        - missed_results
        - expected_matches
      saida:
        - false_negative_list
        - recall_issues
        - filtering_bugs
      confidence: 0.89

    - name: tune-relevance-scoring
      agent: search-quality-analyst
      entrada:
        - scoring_weights
        - training_data
      saida:
        - optimized_weights
        - precision_improvement
        - recall_improvement
      confidence: 0.84

    - name: verify-search-quality
      agent: search-quality-analyst
      entrada:
        - test_queries
        - quality_metrics
      saida:
        - quality_report
        - precision_recall_f1
        - user_satisfaction
      confidence: 0.87

  workflows:
    - name: root-cause-investigation
      description: Orchestrates all 4 agents to systematically investigate and fix all bugs
      phases:
        - investigation
        - analysis
        - fixing
        - testing
        - verification
      entrada:
        - bug_reports
        - production_logs
        - user_feedback
      saida:
        - investigation_report
        - fix_summary
        - deployment_plan
        - verification_results
      elicit: true
      confidence: 0.91

  template: basic
  config_mode: extend

metadata:
  created_at: 2026-02-10T00:00:00Z
  source_docs:
    - Verbal description - Export 404, Search persistence, Billing debit, Search quality bugs
  user_adjustments: 1
  overall_confidence: 0.90
