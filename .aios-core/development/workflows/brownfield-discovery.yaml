workflow:
  id: brownfield-discovery
  name: Brownfield Discovery - Complete Technical Debt Assessment
  version: "3.1"
  description: >-
    Comprehensive multi-agent discovery workflow for existing projects.
    Includes specialist validation cycles and executive awareness report.
    Designed for projects migrating from Lovable, v0.dev, or legacy codebases.

    VERSION 3.0 CHANGES:
    - Uses WorkflowOrchestrator for real subagent dispatch
    - Each phase references REAL TASK files (no generic prompts)
    - Deterministic code for file operations (mkdir, validation)
    - Checklist-based quality validation
  type: brownfield
  project_types:
    - technical-debt-resolution
    - legacy-modernization
    - project-migration
    - codebase-audit
    - lovable-migration

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #                              PRE-FLIGHT CONFIGURATION (V3.1)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  pre_flight:
    # Enable pre-flight tech stack detection
    enabled: true

    # Use TechStackDetector for detection
    detector: TechStackDetector

    # Continue workflow even if no stack detected
    abort_on_empty: false

    # Log detection results to console
    log_results: true

    # Detection includes:
    #   - hasDatabase (Supabase, PostgreSQL, MongoDB, etc.)
    #   - hasFrontend (React, Vue, Angular, etc.)
    #   - hasBackend (Express, Fastify, Edge Functions, etc.)
    #   - hasTypeScript
    #   - hasTests

  # Condition aliases for workflow phases
  condition_aliases:
    project_has_database: 'techStackProfile.hasDatabase'
    project_has_frontend: 'techStackProfile.hasFrontend'
    project_has_backend: 'techStackProfile.hasBackend'
    supabase_configured: 'techStackProfile.database.type === "supabase"'
    qa_review_approved: 'phaseOutputs.7.approved === true'

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #                              ORCHESTRATION CONFIGURATION
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  orchestration:
    # Phases that can run in parallel (no dependencies between them)
    parallel_phases: [1, 2, 3]

    # Use real subagents with persona transformation
    subagent_mode: true

    # V3.1: Dispatch mode - 'skill' uses AIOS Skills, 'task' uses Task tool
    dispatch_mode: skill

    # Maximum concurrent subagent executions
    max_concurrency: 3

    # V3.1: Early exit configuration
    early_exit:
      enabled: true
      log_skipped: true
      save_skip_reason: true

    # Directory structure created BEFORE any phase (via code, not AI)
    setup_directories:
      - docs/architecture
      - docs/frontend
      - docs/prd
      - docs/reviews
      - docs/reports
      - docs/stories
      - supabase/docs
      - .aios/workflow-state

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #                              STARTUP CONFIGURATION
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  startup:
    mode: single_option
    default_action: yolo
    options:
      - id: yolo
        label: "ğŸš€ Iniciar Discovery (YOLO Mode)"
        description: "Executa todas as fases automaticamente com mÃ­nima interaÃ§Ã£o"
        sets_yolo: true
    # NÃ£o mostrar tabela de fases nem mÃºltiplas opÃ§Ãµes
    show_phases_table: false
    show_detailed_menu: false

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #                              WORKFLOW SEQUENCE
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  sequence:

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # FASE 1-3: COLETA DE DADOS (pode ser paralelo)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    - step: system_documentation
      phase: 1
      phase_name: "Coleta: Sistema"
      agent: architect
      action: document-project

      # TASK FILE - Real task definition (not generic prompt)
      task: document-project.md

      # CHECKLIST - Validation after completion
      checklist: architect-checklist.md

      # TEMPLATE - Output format
      template: brownfield-architecture-tmpl.yaml

      creates: docs/architecture/system-architecture.md
      elicit: true
      duration_estimate: "30-60 min"

      # PRE-ACTIONS - Deterministic code operations BEFORE subagent
      preActions:
        - type: mkdir
          path: docs/architecture
        - type: check_tool
          tool: exa
          blocking: false
        - type: check_tool
          tool: github-cli
          blocking: false

      # POST-ACTIONS - Deterministic validation AFTER subagent
      postActions:
        - type: file_exists
          path: docs/architecture/system-architecture.md
        - type: min_file_size
          path: docs/architecture/system-architecture.md
          minKb: 5
        - type: run_checklist
          checklist: architect-checklist.md

      notes: |
        @architect analisa e documenta o sistema completo.

        TASK: document-project.md (arquivo completo carregado)
        CHECKLIST: architect-checklist.md (validaÃ§Ã£o pÃ³s-execuÃ§Ã£o)
        TEMPLATE: brownfield-architecture-tmpl.yaml

        OUTPUT: docs/architecture/system-architecture.md

    - step: database_documentation
      phase: 2
      phase_name: "Coleta: Database"
      agent: data-engineer
      action: schema-audit

      # V3.1: Skill reference for dispatch
      skill: 'AIOS:agents:data-engineer'

      # TASK FILES - Real task definitions
      task: db-schema-audit.md

      # CHECKLIST - Validation after completion
      checklist: database-design-checklist.md

      creates:
        - supabase/docs/SCHEMA.md
        - supabase/docs/DB-AUDIT.md
      condition: project_has_database
      elicit: true
      duration_estimate: "20-40 min"

      # V3.1: Early exit behavior when condition is false
      on_condition_false:
        action: skip
        log: 'No database detected - skipping database documentation phase'
        save_to_context: true

      # PRE-ACTIONS - Deterministic code operations
      preActions:
        - type: mkdir
          path: supabase/docs
        - type: check_env
          vars: [SUPABASE_URL, SUPABASE_KEY]
          blocking: false

      # POST-ACTIONS - Deterministic validation
      postActions:
        - type: file_exists
          path: supabase/docs/SCHEMA.md
        - type: run_checklist
          checklist: database-design-checklist.md

      notes: |
        @data-engineer analisa o banco de dados.

        TASK: db-schema-audit.md + db-rls-audit.md
        CHECKLIST: database-design-checklist.md

        Se nÃ£o houver banco, esta fase Ã© PULADA automaticamente.

        OUTPUT:
        - supabase/docs/SCHEMA.md
        - supabase/docs/DB-AUDIT.md

    - step: frontend_documentation
      phase: 3
      phase_name: "Coleta: Frontend/UX"
      agent: ux-design-expert
      action: audit-codebase

      # TASK FILE - Real task definition
      task: audit-codebase.md

      # CHECKLIST - Validation after completion
      checklist: component-quality-checklist.md

      # TEMPLATE - Output format
      template: front-end-spec-tmpl.yaml

      creates: docs/frontend/frontend-spec.md
      elicit: true
      duration_estimate: "30-45 min"

      # PRE-ACTIONS - Deterministic code operations
      preActions:
        - type: mkdir
          path: docs/frontend

      # POST-ACTIONS - Deterministic validation
      postActions:
        - type: file_exists
          path: docs/frontend/frontend-spec.md
        - type: min_file_size
          path: docs/frontend/frontend-spec.md
          minKb: 3
        - type: run_checklist
          checklist: component-quality-checklist.md

      notes: |
        @ux-design-expert analisa o frontend.

        TASK: audit-codebase.md
        CHECKLIST: component-quality-checklist.md
        TEMPLATE: front-end-spec-tmpl.yaml

        OUTPUT: docs/frontend/frontend-spec.md

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # FASE 4: CONSOLIDAÃ‡ÃƒO INICIAL (DRAFT)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    - step: initial_consolidation
      phase: 4
      phase_name: "ConsolidaÃ§Ã£o Inicial"
      agent: architect
      action: consolidate_findings_draft
      creates: docs/prd/technical-debt-DRAFT.md
      requires:
        - docs/architecture/system-architecture.md
        - supabase/docs/SCHEMA.md (if exists)
        - supabase/docs/DB-AUDIT.md (if exists)
        - docs/frontend/frontend-spec.md
      elicit: true
      duration_estimate: "30-45 min"
      notes: |
        @architect consolida TODOS os dÃ©bitos identificados em DRAFT:

        ESTRUTURA DO DRAFT:
        ```markdown
        # Technical Debt Assessment - DRAFT
        ## Para RevisÃ£o dos Especialistas

        ### 1. DÃ©bitos de Sistema
        [Lista do system-architecture.md]

        ### 2. DÃ©bitos de Database
        [Lista do DB-AUDIT.md]
        âš ï¸ PENDENTE: RevisÃ£o do @data-engineer

        ### 3. DÃ©bitos de Frontend/UX
        [Lista do frontend-spec.md]
        âš ï¸ PENDENTE: RevisÃ£o do @ux-expert

        ### 4. Matriz Preliminar
        | ID | DÃ©bito | Ãrea | Impacto | EsforÃ§o | Prioridade |
        |----|--------|------|---------|---------|------------|

        ### 5. Perguntas para Especialistas
        - @data-engineer: [perguntas sobre DB]
        - @ux-expert: [perguntas sobre UX]
        ```

        COMANDO: @architect (prompt manual)

        PROMPT:
        ```
        Leia os documentos gerados nas fases anteriores:
        1. docs/architecture/system-architecture.md
        2. supabase/docs/SCHEMA.md
        3. supabase/docs/DB-AUDIT.md
        4. docs/frontend/frontend-spec.md

        Crie um DRAFT consolidando todos os dÃ©bitos tÃ©cnicos.
        Marque claramente as seÃ§Ãµes que precisam de revisÃ£o dos especialistas.
        Adicione perguntas especÃ­ficas para @data-engineer e @ux-expert.

        Salve em: docs/prd/technical-debt-DRAFT.md
        ```

        OUTPUT: docs/prd/technical-debt-DRAFT.md

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # FASE 5-7: VALIDAÃ‡ÃƒO DOS ESPECIALISTAS
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    - step: database_specialist_review
      phase: 5
      phase_name: "ValidaÃ§Ã£o: Database"
      agent: data-engineer
      action: review_and_validate
      creates: docs/reviews/db-specialist-review.md
      requires: docs/prd/technical-debt-DRAFT.md
      elicit: true
      duration_estimate: "20-30 min"
      notes: |
        @data-engineer revisa a seÃ§Ã£o de Database do DRAFT:

        RESPONSABILIDADES:
        1. VALIDAR dÃ©bitos identificados
           - Confirma se sÃ£o realmente problemas
           - Ajusta severidade se necessÃ¡rio
           - Adiciona dÃ©bitos nÃ£o identificados

        2. ESTIMAR CUSTOS
           - Horas para resolver cada dÃ©bito
           - Complexidade (simples/mÃ©dio/complexo)
           - DependÃªncias tÃ©cnicas

        3. PRIORIZAR (perspectiva DB)
           - Risco de seguranÃ§a
           - Impacto em performance
           - DÃ­vida de manutenÃ§Ã£o

        4. RESPONDER PERGUNTAS
           - Responde perguntas do @architect
           - Esclarece pontos tÃ©cnicos

        COMANDO: @data-engineer (prompt manual)

        PROMPT:
        ```
        Leia o DRAFT em: docs/prd/technical-debt-DRAFT.md

        Como especialista em Database, revise a seÃ§Ã£o de dÃ©bitos de dados:

        1. Valide cada dÃ©bito (confirma/ajusta/remove)
        2. Adicione dÃ©bitos que faltaram
        3. Estime horas para resolver cada um
        4. Priorize do ponto de vista de dados
        5. Responda as perguntas do architect

        Crie seu review em: docs/reviews/db-specialist-review.md

        Formato:
        ## Database Specialist Review

        ### DÃ©bitos Validados
        | ID | DÃ©bito | Severidade | Horas | Prioridade | Notas |

        ### DÃ©bitos Adicionados
        [novos dÃ©bitos identificados]

        ### Respostas ao Architect
        [respostas Ã s perguntas]

        ### RecomendaÃ§Ãµes
        [ordem de resoluÃ§Ã£o recomendada]
        ```

        OUTPUT: docs/reviews/db-specialist-review.md

    - step: ux_specialist_review
      phase: 6
      phase_name: "ValidaÃ§Ã£o: UX/Frontend"
      agent: ux-design-expert
      action: review_and_validate
      creates: docs/reviews/ux-specialist-review.md
      requires: docs/prd/technical-debt-DRAFT.md
      elicit: true
      duration_estimate: "20-30 min"
      notes: |
        @ux-expert revisa a seÃ§Ã£o de Frontend/UX do DRAFT:

        RESPONSABILIDADES:
        1. VALIDAR dÃ©bitos identificados
           - Confirma se afetam UX
           - Ajusta severidade se necessÃ¡rio
           - Adiciona dÃ©bitos nÃ£o identificados

        2. ESTIMAR CUSTOS
           - Horas para resolver cada dÃ©bito
           - Impacto visual vs funcional
           - Necessidade de design review

        3. PRIORIZAR (perspectiva UX)
           - Impacto na experiÃªncia do usuÃ¡rio
           - Problemas de acessibilidade
           - ConsistÃªncia visual

        4. RESPONDER PERGUNTAS
           - Responde perguntas do @architect
           - Sugere soluÃ§Ãµes de design

        COMANDO: @ux-expert (prompt manual)

        PROMPT:
        ```
        Leia o DRAFT em: docs/prd/technical-debt-DRAFT.md

        Como especialista em UX/Frontend, revise a seÃ§Ã£o de dÃ©bitos de UI:

        1. Valide cada dÃ©bito (confirma/ajusta/remove)
        2. Adicione dÃ©bitos que faltaram
        3. Estime horas para resolver cada um
        4. Priorize do ponto de vista de UX
        5. Responda as perguntas do architect

        Crie seu review em: docs/reviews/ux-specialist-review.md

        Formato:
        ## UX Specialist Review

        ### DÃ©bitos Validados
        | ID | DÃ©bito | Severidade | Horas | Prioridade | Impacto UX |

        ### DÃ©bitos Adicionados
        [novos dÃ©bitos identificados]

        ### Respostas ao Architect
        [respostas Ã s perguntas]

        ### RecomendaÃ§Ãµes de Design
        [soluÃ§Ãµes sugeridas]
        ```

        OUTPUT: docs/reviews/ux-specialist-review.md

    - step: qa_general_review
      phase: 7
      phase_name: "ValidaÃ§Ã£o: QA Review"
      agent: qa
      action: review_assessment
      creates: docs/reviews/qa-review.md
      requires:
        - docs/prd/technical-debt-DRAFT.md
        - docs/reviews/db-specialist-review.md (if exists)  # Phase 5 may be skipped if no database
        - docs/reviews/ux-specialist-review.md
      elicit: true
      duration_estimate: "30-45 min"
      notes: |
        @qa faz review geral de qualidade do assessment:

        RESPONSABILIDADES:
        1. IDENTIFICAR GAPS
           - DÃ©bitos nÃ£o cobertos
           - Ãreas nÃ£o analisadas
           - Riscos cruzados

        2. AVALIAR RISCOS
           - Riscos de seguranÃ§a
           - Riscos de regressÃ£o
           - Riscos de integraÃ§Ã£o

        3. VALIDAR DEPENDÃŠNCIAS
           - Ordem de resoluÃ§Ã£o faz sentido?
           - DependÃªncias entre dÃ©bitos
           - Bloqueios potenciais

        4. SUGERIR TESTES
           - Testes necessÃ¡rios pÃ³s-resoluÃ§Ã£o
           - CritÃ©rios de aceite para dÃ©bitos
           - MÃ©tricas de qualidade

        5. QUALITY GATE
           - O assessment estÃ¡ completo?
           - Pode seguir para planning?

        COMANDO: @qa (prompt manual)

        PROMPT:
        ```
        Leia todos os documentos:
        1. docs/prd/technical-debt-DRAFT.md
        2. docs/reviews/db-specialist-review.md
        3. docs/reviews/ux-specialist-review.md

        Como QA, faÃ§a review geral:

        1. Identifique gaps no assessment
        2. Avalie riscos cruzados entre Ã¡reas
        3. Valide se dependÃªncias fazem sentido
        4. Sugira testes para validar resoluÃ§Ã£o
        5. DÃª parecer: APPROVED / NEEDS WORK

        Crie seu review em: docs/reviews/qa-review.md

        Formato:
        ## QA Review - Technical Debt Assessment

        ### Gate Status: [APPROVED / NEEDS WORK]

        ### Gaps Identificados
        [Ã¡reas nÃ£o cobertas]

        ### Riscos Cruzados
        | Risco | Ãreas Afetadas | MitigaÃ§Ã£o |

        ### DependÃªncias Validadas
        [ordem correta? bloqueios?]

        ### Testes Requeridos
        [testes pÃ³s-resoluÃ§Ã£o]

        ### Parecer Final
        [comentÃ¡rios gerais]
        ```

        OUTPUT: docs/reviews/qa-review.md

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # FASE 8: ASSESSMENT FINAL CONSOLIDADO
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    - step: final_assessment
      phase: 8
      phase_name: "Assessment Final"
      agent: architect
      action: finalize_assessment
      creates: docs/prd/technical-debt-assessment.md
      requires:
        - docs/prd/technical-debt-DRAFT.md
        - docs/reviews/db-specialist-review.md
        - docs/reviews/ux-specialist-review.md
        - docs/reviews/qa-review.md
      condition: qa_review_approved
      elicit: true
      duration_estimate: "30-45 min"
      notes: |
        @architect finaliza o assessment incorporando TODOS os inputs:

        CONSOLIDAÃ‡ÃƒO FINAL:
        1. Incorpora ajustes do @data-engineer
        2. Incorpora ajustes do @ux-expert
        3. EndereÃ§a gaps do @qa
        4. Recalcula prioridades com inputs dos especialistas
        5. Define ordem final de resoluÃ§Ã£o

        ESTRUTURA FINAL:
        ```markdown
        # Technical Debt Assessment - FINAL

        ## Executive Summary
        - Total de dÃ©bitos: X
        - CrÃ­ticos: Y | Altos: Z | MÃ©dios: W
        - EsforÃ§o total estimado: XXX horas

        ## InventÃ¡rio Completo de DÃ©bitos

        ### Sistema (validado por @architect)
        | ID | DÃ©bito | Severidade | Horas | Prioridade |

        ### Database (validado por @data-engineer)
        | ID | DÃ©bito | Severidade | Horas | Prioridade |

        ### Frontend/UX (validado por @ux-expert)
        | ID | DÃ©bito | Severidade | Horas | Prioridade |

        ## Matriz de PriorizaÃ§Ã£o Final
        [consolidada com inputs de todos]

        ## Plano de ResoluÃ§Ã£o
        [ordem, dependÃªncias, timeline]

        ## Riscos e MitigaÃ§Ãµes
        [do QA review]

        ## CritÃ©rios de Sucesso
        [mÃ©tricas, testes]
        ```

        COMANDO: @architect (prompt manual)

        OUTPUT: docs/prd/technical-debt-assessment.md

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # FASE 9: RELATÃ“RIO EXECUTIVO DE AWARENESS
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    - step: executive_awareness_report
      phase: 9
      phase_name: "RelatÃ³rio Executivo"
      agent: analyst
      action: create_awareness_report
      creates: docs/reports/TECHNICAL-DEBT-REPORT.md
      requires: docs/prd/technical-debt-assessment.md
      elicit: true
      duration_estimate: "30-45 min"
      notes: |
        @analyst cria relatÃ³rio executivo para awareness:

        OBJETIVO:
        Documento para stakeholders entenderem o CUSTO e IMPACTO
        dos dÃ©bitos tÃ©cnicos identificados.

        ESTRUTURA DO RELATÃ“RIO:
        ```markdown
        # ğŸ“Š RelatÃ³rio de DÃ©bito TÃ©cnico
        **Projeto:** [nome]
        **Data:** [data]
        **VersÃ£o:** 1.0

        ---

        ## ğŸ¯ Executive Summary (1 pÃ¡gina)

        ### SituaÃ§Ã£o Atual
        [resumo em 3 parÃ¡grafos]

        ### NÃºmeros Chave
        | MÃ©trica | Valor |
        |---------|-------|
        | Total de DÃ©bitos | X |
        | DÃ©bitos CrÃ­ticos | Y |
        | EsforÃ§o Total | Z horas |
        | Custo Estimado | R$ XX.XXX |

        ### RecomendaÃ§Ã£o
        [aÃ§Ã£o recomendada em 1 parÃ¡grafo]

        ---

        ## ğŸ’° AnÃ¡lise de Custos

        ### Custo de RESOLVER
        | Categoria | Horas | Custo (R$150/h) |
        |-----------|-------|-----------------|
        | Sistema | XX | R$ X.XXX |
        | Database | XX | R$ X.XXX |
        | Frontend | XX | R$ X.XXX |
        | **TOTAL** | **XXX** | **R$ XX.XXX** |

        ### Custo de NÃƒO RESOLVER (Risco Acumulado)
        | Risco | Probabilidade | Impacto | Custo Potencial |
        |-------|---------------|---------|-----------------|
        | Breach de seguranÃ§a | Alta | CrÃ­tico | R$ XXX.XXX |
        | Perda de performance | MÃ©dia | Alto | R$ XX.XXX |
        | Churn de usuÃ¡rios | MÃ©dia | Alto | R$ XX.XXX |

        **Custo potencial de nÃ£o agir: R$ XXX.XXX**

        ---

        ## ğŸ“ˆ Impacto no NegÃ³cio

        ### Performance
        - Tempo de carregamento atual: X segundos
        - Meta apÃ³s resoluÃ§Ã£o: Y segundos
        - Impacto: +Z% conversÃ£o estimada

        ### SeguranÃ§a
        - Vulnerabilidades identificadas: X
        - Risco de compliance: [baixo/mÃ©dio/alto]
        - Impacto: proteÃ§Ã£o de dados de X usuÃ¡rios

        ### ExperiÃªncia do UsuÃ¡rio
        - Problemas de UX: X
        - Taxa de abandono estimada: Y%
        - Impacto: reduÃ§Ã£o de Z% no churn

        ### Manutenibilidade
        - Tempo mÃ©dio para novo feature: X dias
        - ApÃ³s resoluÃ§Ã£o: Y dias
        - Impacto: +Z% velocidade de entrega

        ---

        ## â±ï¸ Timeline Recomendado

        ### Fase 1: Quick Wins (1-2 semanas)
        - [dÃ©bitos de baixo esforÃ§o/alto impacto]
        - Custo: R$ X.XXX
        - ROI imediato

        ### Fase 2: FundaÃ§Ã£o (2-4 semanas)
        - [dÃ©bitos estruturais crÃ­ticos]
        - Custo: R$ X.XXX
        - Habilita features futuras

        ### Fase 3: OtimizaÃ§Ã£o (4-6 semanas)
        - [dÃ©bitos de mÃ©dio prazo]
        - Custo: R$ X.XXX
        - Melhoria contÃ­nua

        ---

        ## ğŸ“Š ROI da ResoluÃ§Ã£o

        | Investimento | Retorno Esperado |
        |--------------|------------------|
        | R$ XX.XXX (resoluÃ§Ã£o) | R$ XXX.XXX (riscos evitados) |
        | XXX horas | +Y% velocidade de dev |
        | 6-8 semanas | Produto sustentÃ¡vel |

        **ROI Estimado: X:1**

        ---

        ## âœ… PrÃ³ximos Passos

        1. [ ] Aprovar orÃ§amento de R$ XX.XXX
        2. [ ] Definir sprint de resoluÃ§Ã£o
        3. [ ] Alocar time tÃ©cnico
        4. [ ] Iniciar Fase 1 (Quick Wins)

        ---

        ## ğŸ“ Anexos
        - [Link para Assessment TÃ©cnico Completo]
        - [Link para Epic de ResoluÃ§Ã£o]
        - [Link para Stories Detalhadas]
        ```

        COMANDO: @analyst (prompt manual)

        PROMPT:
        ```
        Leia: docs/prd/technical-debt-assessment.md

        Crie um relatÃ³rio executivo de awareness para stakeholders.

        Foco em:
        1. Custos claros (resolver vs nÃ£o resolver)
        2. Impacto no negÃ³cio (nÃ£o tÃ©cnico)
        3. Timeline realista
        4. ROI da resoluÃ§Ã£o

        Use linguagem de negÃ³cio, nÃ£o tÃ©cnica.
        Valores em R$ (considere R$150/hora como base).

        Salve em: docs/reports/TECHNICAL-DEBT-REPORT.md
        ```

        OUTPUT: docs/reports/TECHNICAL-DEBT-REPORT.md

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # FASE 10: PLANNING (Epic + Stories)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    - step: epic_creation
      phase: 10
      phase_name: "Planning: Epic"
      agent: pm
      action: create-epic
      creates: docs/stories/epic-technical-debt.md
      requires:
        - docs/prd/technical-debt-assessment.md
        - docs/reports/TECHNICAL-DEBT-REPORT.md
      elicit: true
      duration_estimate: "20-30 min"
      notes: |
        @pm cria epic baseado no assessment validado:

        EPIC: "ResoluÃ§Ã£o de DÃ©bitos TÃ©cnicos - [Nome do Projeto]"

        Estrutura:
        - Objetivo do epic
        - Escopo (quais dÃ©bitos)
        - CritÃ©rios de sucesso
        - Timeline (do relatÃ³rio)
        - Budget aprovado
        - Lista de stories

        COMANDO: @pm â†’ *create-epic

        OUTPUT: docs/stories/epic-technical-debt.md

    - step: story_creation
      phase: 10
      phase_name: "Planning: Stories"
      agent: pm
      action: create-story
      creates: docs/stories/story-X.X-*.md
      requires: docs/stories/epic-technical-debt.md
      repeats: for_each_prioritized_debt
      elicit: true
      duration_estimate: "15-20 min por story"
      notes: |
        @pm cria stories para cada dÃ©bito/grupo de dÃ©bitos:

        Para cada item priorizado:
        - Story com tasks claras
        - CritÃ©rios de aceite especÃ­ficos
        - Testes requeridos (do QA review)
        - Estimativa validada pelos especialistas
        - Definition of Done

        COMANDO: @pm â†’ *create-story (repetir)

        OUTPUT:
        - docs/stories/story-1.1-fix-security-rls.md
        - docs/stories/story-1.2-add-missing-indexes.md
        - docs/stories/story-1.3-implement-design-system.md
        - ...

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # WORKFLOW COMPLETE
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    - workflow_end:
      action: discovery_complete
      notes: |
        âœ… DISCOVERY COMPLETO!

        Artefatos gerados:
        ```
        docs/
        â”œâ”€â”€ architecture/
        â”‚   â””â”€â”€ system-architecture.md         [FASE 1]
        â”œâ”€â”€ frontend/
        â”‚   â””â”€â”€ frontend-spec.md               [FASE 3]
        â”œâ”€â”€ reviews/
        â”‚   â”œâ”€â”€ db-specialist-review.md        [FASE 5]
        â”‚   â”œâ”€â”€ ux-specialist-review.md        [FASE 6]
        â”‚   â””â”€â”€ qa-review.md                   [FASE 7]
        â”œâ”€â”€ prd/
        â”‚   â”œâ”€â”€ technical-debt-DRAFT.md        [FASE 4]
        â”‚   â””â”€â”€ technical-debt-assessment.md   [FASE 8]
        â”œâ”€â”€ reports/
        â”‚   â””â”€â”€ TECHNICAL-DEBT-REPORT.md       [FASE 9] â­
        â””â”€â”€ stories/
            â”œâ”€â”€ epic-technical-debt.md         [FASE 10]
            â”œâ”€â”€ story-1.1-*.md
            â””â”€â”€ story-1.2-*.md

        supabase/
        â””â”€â”€ docs/
            â”œâ”€â”€ SCHEMA.md                      [FASE 2]
            â””â”€â”€ DB-AUDIT.md                    [FASE 2]
        ```

        PRÃ“XIMOS PASSOS:
        1. Apresentar TECHNICAL-DEBT-REPORT.md para stakeholders
        2. Obter aprovaÃ§Ã£o de budget
        3. Iniciar desenvolvimento: @dev â†’ story-1.1

        TEMPO TOTAL ESTIMADO: 4-6 horas

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #                              QUICK REFERENCE
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  quick_reference:
    fase_1:
      name: "Coleta: Sistema"
      agent: "@architect"
      command: "*document-project"
      output: "docs/architecture/system-architecture.md"
      duration: "30-60 min"
    fase_2:
      name: "Coleta: Database"
      agent: "@data-engineer"
      command: "*load-schema + *security-audit"
      output: "supabase/docs/SCHEMA.md, DB-AUDIT.md"
      duration: "20-40 min"
    fase_3:
      name: "Coleta: Frontend"
      agent: "@ux-design-expert"
      command: "*create-front-end-spec"
      output: "docs/frontend/frontend-spec.md"
      duration: "30-45 min"
    fase_4:
      name: "ConsolidaÃ§Ã£o Inicial"
      agent: "@architect"
      command: "(manual prompt)"
      output: "docs/prd/technical-debt-DRAFT.md"
      duration: "30-45 min"
    fase_5:
      name: "ValidaÃ§Ã£o DB"
      agent: "@data-engineer"
      command: "(manual review)"
      output: "docs/reviews/db-specialist-review.md"
      duration: "20-30 min"
    fase_6:
      name: "ValidaÃ§Ã£o UX"
      agent: "@ux-design-expert"
      command: "(manual review)"
      output: "docs/reviews/ux-specialist-review.md"
      duration: "20-30 min"
    fase_7:
      name: "QA Review"
      agent: "@qa"
      command: "(manual review)"
      output: "docs/reviews/qa-review.md"
      duration: "30-45 min"
    fase_8:
      name: "Assessment Final"
      agent: "@architect"
      command: "(manual consolidation)"
      output: "docs/prd/technical-debt-assessment.md"
      duration: "30-45 min"
    fase_9:
      name: "RelatÃ³rio Executivo"
      agent: "@analyst"
      command: "(manual report)"
      output: "docs/reports/TECHNICAL-DEBT-REPORT.md"
      duration: "30-45 min"
    fase_10:
      name: "Planning"
      agent: "@pm"
      command: "*create-epic + *create-story"
      output: "docs/stories/epic-*.md, story-*.md"
      duration: "30-60 min"

  time_estimate:
    minimum: "4 horas"
    typical: "5-6 horas"
    complex_project: "8 horas"

  decision_guidance:
    when_to_use:
      - Migrando projeto de Lovable/v0.dev
      - Auditoria completa de codebase
      - Planejamento de modernizaÃ§Ã£o
      - Assessment antes de investimento
      - Onboarding em projeto legado
      - Due diligence tÃ©cnica

  handoff_prompts:
    coleta_complete: |
      Fases 1-3 completas. DocumentaÃ§Ã£o coletada:
      - Sistema: docs/architecture/system-architecture.md
      - Database: supabase/docs/SCHEMA.md
      - Frontend: docs/frontend/frontend-spec.md

      PrÃ³ximo: @architect para consolidaÃ§Ã£o inicial (FASE 4)

    draft_complete: |
      DRAFT criado: docs/prd/technical-debt-DRAFT.md

      PrÃ³ximo: ValidaÃ§Ã£o dos especialistas (FASES 5-7)
      - @data-engineer: revisar seÃ§Ã£o de Database
      - @ux-expert: revisar seÃ§Ã£o de Frontend
      - @qa: review geral

    validation_complete: |
      ValidaÃ§Ãµes completas:
      - docs/reviews/db-specialist-review.md âœ…
      - docs/reviews/ux-specialist-review.md âœ…
      - docs/reviews/qa-review.md âœ…

      PrÃ³ximo: @architect para assessment final (FASE 8)

    assessment_complete: |
      Assessment final: docs/prd/technical-debt-assessment.md

      PrÃ³ximo: @analyst para relatÃ³rio executivo (FASE 9)

    report_complete: |
      RelatÃ³rio executivo: docs/reports/TECHNICAL-DEBT-REPORT.md

      PrÃ³ximo: @pm para criar epic e stories (FASE 10)

    workflow_complete: |
      âœ… DISCOVERY COMPLETO!

      Documentos para stakeholders:
      - docs/reports/TECHNICAL-DEBT-REPORT.md (executivo)

      Documentos para desenvolvimento:
      - docs/stories/epic-technical-debt.md
      - docs/stories/story-*.md

      Pronto para: @dev implementar stories
